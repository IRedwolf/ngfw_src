Ext.define("Ung.util.Rpc",{alternateClassName:"Rpc",singleton:!0,asyncData:function(e){var t=[].slice.call(arguments).splice(1),i=e.split("."),n=i.pop(),a=window,o=new Ext.Deferred;return i.forEach(function(e){a=a[e]}),a.hasOwnProperty(n)&&Ext.isFunction(a[n])?(t.unshift(function(t,i){i&&(console.error("Error: "+i),Util.exceptionToast(i),o.reject(i)),console.info(e+" (async data) ... OK"),o.resolve(t)}),a[n].apply(null,t),o.promise):(console.error("Error: No such RPC method: '"+e+"'"),void Util.exceptionToast("No such RPC method: '"+e+"'"))},directData:function(e){var t=e.split("."),i=t.pop(),n=window;if(t.forEach(function(e){n=n[e]}),!n.hasOwnProperty(i)||!Ext.isFunction(n[i]))return console.error("Error: No such RPC method: '"+e+"'"),void Util.exceptionToast("No such RPC method: '"+e+"'");try{return n[i].call()}catch(e){Util.exceptionToast(e)}},asyncPromise:function(e){var t=[].slice.call(arguments).splice(1),i=e.split("."),n=i.pop(),a=window;return i.forEach(function(e){a=a[e]}),a.hasOwnProperty(n)&&Ext.isFunction(a[n])?function(){var i=new Ext.Deferred;return t.unshift(function(t,n){n&&i.reject(n),console.info(e+" (async promise) ... OK"),i.resolve(t)}),a[n].apply(null,t),i.promise}:(console.error("Error: No such RPC method: '"+e+"'"),void Util.exceptionToast("No such RPC method: '"+e+"'"))},directPromise:function(e){var t=e.split("."),i=t.pop(),n=window;return t.forEach(function(e){n=n[e]}),n.hasOwnProperty(i)&&Ext.isFunction(n[i])?function(){var t=new Ext.Deferred;try{console.info(e+" (direct promise) ... OK"),t.resolve(n[i].call())}catch(e){t.reject(e)}return t.promise}:(console.error("Error: No such RPC method: '"+e+"'"),void Util.exceptionToast("No such RPC method: '"+e+"'"))}}),Ext.define("Ung.util.Util",{alternateClassName:"Util",singleton:!0,nodeClassMapping:{"untangle-node-web-filter":"Ung.node.WebFilter","untangle-node-web-filter-lite":"Ung.node.WebFilterLite","untangle-node-virus-blocker":"Ung.node.VirusBlocker","untangle-node-virus-blocker-lite":"Ung.node.VirusBlockerLite","untangle-node-spam-blocker":"Ung.node.SpamBlocker","untangle-node-spam-blocker-lite":"Ung.node.SpamBlockerLite","untangle-node-phish-blocker":"Ung.node.PhishBlocker","untangle-node-web-cache":"Ung.node.WebCache","untangle-node-bandwidth-control":"Ung.node.BandwidthControl","untangle-casing-ssl-inspector":"Ung.node.SslInspector","untangle-node-application-control":"Ung.node.ApplicationControl","untangle-node-application-control-lite":"Ung.node.ApplicationControlLite","untangle-node-captive-portal":"Ung.node.CaptivePortal","untangle-node-firewall":"Ung.node.Firewall","untangle-node-ad-blocker":"Ung.node.AdBlocker","untangle-node-reports":"Ung.node.Reports"},iconReportTitle:function(e){var t;switch(e.get("type")){case"TEXT":t="subject";break;case"EVENT_LIST":t="format_list_bulleted";break;case"PIE_GRAPH":t="pie_chart","COLUMN"===e.get("pieStyle")||"COLUMN_3D"===e.get("pieStyle")?t="insert_chart":"DONUT"!==e.get("pieStyle")&&"DONUT_3D"!==e.get("pieStyle")||(t="donut_large");break;case"TIME_GRAPH":case"TIME_GRAPH_DYNAMIC":t=e.get("timeStyle").indexOf("BAR")>=0?"insert_chart":"show_chart";break;default:t="subject"}return'<i class="material-icons" style="font-size: 18px">'+t+"</i>"},bytesToHumanReadable:function(e,t){var i=t?1e3:1024;if(Math.abs(e)<i)return e+" B";var n=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],a=-1;do e/=i,++a;while(Math.abs(e)>=i&&a<n.length-1);return e.toFixed(1)+" "+n[a]},formatBytes:function(e,t){if(0===e)return"0";var i=1e3,n=t||3,a=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(e)/Math.log(i));return parseFloat((e/Math.pow(i,o)).toFixed(n))+" "+a[o]},iconTitle:function(e,t){var i=t.split("-")[0],n=t.split("-")[1]||24;return'<i class="material-icons" style="font-size: '+n+'px">'+i+'</i> <span style="vertical-align: middle;">'+e+"</span>"},successToast:function(e){Ext.toast({html:'<i class="fa fa-check fa-lg"></i> '+e,bodyPadding:"12 12 12 40",baseCls:"toast",border:!1,bodyBorder:!1,align:"br",autoCloseDelay:5e3,slideInAnimation:"easeOut",slideInDuration:300,hideDuration:0,paddingX:10,paddingY:50})},exceptionToast:function(e){var t=[];"object"==typeof e?(e.name&&e.code&&t.push("<strong>Name:</strong> "+e.name+" ("+e.code+")"),e.message&&t.push("<strong>Error:</strong> "+e.message)):t=[e],Ext.toast({html:'<i class="fa fa-exclamation-triangle fa-lg"></i> <span style="font-weight: bold; color: yellow;">Exception!</span><br/>'+t.join("<br/>"),bodyPadding:"10 10 10 45",baseCls:"toast",cls:"exception",border:!1,bodyBorder:!1,align:"br",autoCloseDelay:5e3,slideInAnimation:"easeOut",slideInDuration:300,hideDuration:0,paddingX:10,paddingY:50})},invalidFormToast:function(e){if(e&&0!==e.length){var t=[];e.forEach(function(e){t.push('<span class="field-name">'+e.label+'</span>: <br/> <span class="field-error">'+e.error.replace(/<\/?[^>]+(>|$)/g,"")+"</span>")}),Ext.toast({html:'<i class="fa fa-exclamation-triangle fa-lg"></i> <span style="font-weight: bold; font-size: 14px; color: yellow;">Check invalid fields!</span><br/><br/>'+t.join("<br/>"),bodyPadding:"10 10 10 45",baseCls:"toast-invalid-frm",border:!1,bodyBorder:!1,align:"br",autoCloseDelay:5e3,slideInAnimation:"easeOut",slideInDuration:300,hideDuration:0,paddingX:10,paddingY:50})}},getInterfaceListSystemDev:function(e,t,i){var n,a,o=rpc.networkSettings,r=[];for(a=0;a<o.interfaces.list.length;a+=1)n=o.interfaces.list[a],r.push([i?n.systemDev.toString():n.interfaceId.toString(),n.name]);return i?r.push(["tun0","OpenVPN"]):(r.push(["250","OpenVPN"]),r.push(["251","L2TP"]),r.push(["252","Xauth"]),r.push(["253","GRE"])),e&&(r.unshift(["wan","Any WAN".t()]),r.unshift(["non_wan","Any Non-WAN".t()])),t&&r.unshift(["any","Any".t()]),r},getInterfaceList:function(e,t){return Util.getInterfaceListSystemDev(e,t,!1)},interfacesListNamesMap:function(){var e,t,i={wan:"Any WAN".t(),non_wan:"Any Non-WAN".t(),any:"Any".t(),250:"OpenVPN",251:"L2TP",252:"Xauth",253:"GRE"};for(e=0;e<rpc.networkSettings.interfaces.list.length;e+=1)t=rpc.networkSettings.interfaces.list[e],i[t.systemDev]=t.name,i[t.interfaceId]=t.name;return i},urlValidator:function(e){var t=e.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/g);return!!t||"Url missing or in wrong format!".t()},getClassOrder:function(){var e=[],t=[];Ext.Loader.history.forEach(function(i){0===i.indexOf("Ung")?e.push(i.replace("Ung","app").replace(/\./g,"/")+".js"):t.push(i)}),e.pop(),Ext.create("Ext.Window",{title:"Untangle Classes Load Order",width:600,height:600,modal:!0,draggable:!1,resizable:!1,layout:{type:"hbox",align:"stretch",pack:"end"},items:[{xtype:"textarea",border:!1,flex:1,editable:!1,fieldStyle:{background:"#FFF",fontSize:"11px"},value:e.join("\r\n")},{xtype:"textarea",border:!1,flex:1,editable:!1,fieldStyle:{background:"#FFF",fontSize:"11px"},value:t.join("\r\n")}]}).show()},getV4NetmaskList:function(e){var t=[];return e&&t.push([null,"Â "]),t.push([32,"/32 - 255.255.255.255"]),t.push([31,"/31 - 255.255.255.254"]),t.push([30,"/30 - 255.255.255.252"]),t.push([29,"/29 - 255.255.255.248"]),t.push([28,"/28 - 255.255.255.240"]),t.push([27,"/27 - 255.255.255.224"]),t.push([26,"/26 - 255.255.255.192"]),t.push([25,"/25 - 255.255.255.128"]),t.push([24,"/24 - 255.255.255.0"]),t.push([23,"/23 - 255.255.254.0"]),t.push([22,"/22 - 255.255.252.0"]),t.push([21,"/21 - 255.255.248.0"]),t.push([20,"/20 - 255.255.240.0"]),t.push([19,"/19 - 255.255.224.0"]),t.push([18,"/18 - 255.255.192.0"]),t.push([17,"/17 - 255.255.128.0"]),t.push([16,"/16 - 255.255.0.0"]),t.push([15,"/15 - 255.254.0.0"]),t.push([14,"/14 - 255.252.0.0"]),t.push([13,"/13 - 255.248.0.0"]),t.push([12,"/12 - 255.240.0.0"]),t.push([11,"/11 - 255.224.0.0"]),t.push([10,"/10 - 255.192.0.0"]),t.push([9,"/9 - 255.128.0.0"]),t.push([8,"/8 - 255.0.0.0"]),t.push([7,"/7 - 254.0.0.0"]),t.push([6,"/6 - 252.0.0.0"]),t.push([5,"/5 - 248.0.0.0"]),t.push([4,"/4 - 240.0.0.0"]),t.push([3,"/3 - 224.0.0.0"]),t.push([2,"/2 - 192.0.0.0"]),t.push([1,"/1 - 128.0.0.0"]),t.push([0,"/0 - 0.0.0.0"]),t},validateForms:function(e){var t=[];return e.query("form[withValidation]").forEach(function(e){e.isDirty()&&e.query("field{isValid()==false}").forEach(function(e){t.push({label:e.getFieldLabel(),error:e.getActiveError()})})}),!(t.length>0)||(Util.invalidFormToast(t),!1)}}),Ext.define("Ung.util.Metrics",{alternateClassName:"Metrics",singleton:!0,frequency:1e4,interval:null,running:!1,start:function(){var e=this;e.stop(),e.run(),e.interval=window.setInterval(function(){e.run()},e.frequency)},stop:function(){null!==this.interval&&window.clearInterval(this.interval)},run:function(){var e=[];rpc.metricManager.getMetricsAndStats(Ext.bind(function(t,i){i&&console.log(i),e=[],Ext.getStore("stats").loadRawData(t.systemStats);for(var n in t.metrics)t.metrics.hasOwnProperty(n)&&e.push({nodeId:n,metrics:t.metrics[n]});Ext.getStore("metrics").loadData(e)}))}}),Ext.define("Ung.overrides.form.field.VTypes",{override:"Ext.form.field.VTypes",mask:{macAddrMaskRe:/^[a-fA-F0-9]{2}:[a-fA-F0-9]{2}:[a-fA-F0-9]{2}:[a-fA-F0-9]{2}:[a-fA-F0-9]{2}:[a-fA-F0-9]{2}$/,ip4AddrMaskRe:/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ip6AddrMaskRe:/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,email:/^(")?(?:[^\."])(?:(?:[\.])?(?:[\w\-!#$%&'*+\/=?^_`{|}~]))*\1@(\w[\-\w]*\.){1,5}([A-Za-z]){2,63}$/,ipAddrRange:/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)-(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,cidrRange:/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\/[0-3]?[0-9]$/,ipNetmask:/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\/(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/},isSinglePortValid:function(e){return!(e<0||e>65536)&&!!/^\d{1,5}$/.test(e)},isPortRangeValid:function(e){var t=e.split("-");return 2===t.length&&(this.isSinglePortValid(t[0])&&this.isSinglePortValid(t[1]))},isPortListValid:function(e){var t,i=e.split(","),n=!0;for(t=0;t<i.length;t++)if(n=i[t].indexOf("-")!==-1?n&&this.isPortRangeValid(i[t]):n&&this.isSinglePortValid(i[t]),!n)return!1;return!0},isSingleIpValid:function(e){return this.mask.ip4AddrMaskRe.test(e)},isIpRangeValid:function(e){return this.mask.ipAddrRange.test(e)},isCIDRValid:function(e){return this.mask.cidrRange.test(e)},isIpNetmaskValid:function(e){return this.mask.ipNetmask.test(e)},isIpListValid:function(e){var t,i=e.split(","),n=!0;for(t=0;t<i.length;t+=1)if(n=i[t].indexOf("-")!==-1?n&&this.isIpRangeValid(i[t]):i[t].indexOf("/")!==-1?n&&(this.isCIDRValid(i[t])||this.isIpNetmaskValid(i[t])):n&&this.isSingleIpValid(i[t]),!n)return!1;return!0},email:function(e){return this.mask.email.test(e)},ipMatcher:function(e){if(e.indexOf("/")===-1&&e.indexOf(",")===-1&&e.indexOf("-")===-1)switch(e){case"any":return!0;default:return this.isSingleIpValid(e)}if(e.indexOf(",")!==-1)return this.isIpListValid(e);if(e.indexOf("-")!==-1)return this.isIpRangeValid(e);if(e.indexOf("/")!==-1){var t=this.isCIDRValid(e),i=this.isIpNetmaskValid(e);return t||i}return console.log("Unhandled case while handling vtype for ipAddr:",e," returning true !"),!0},ipMatcherText:"Invalid IP Address.".t(),ip4Address:function(e){return this.mask.ip4AddrMaskRe.test(e)},ip4AddressText:"Invalid IPv4 Address.".t(),ip4AddressList:function(e){var t,i=e.split(",");for(t=0;t<i.length;t+=1)if(!this.mask.ip4AddrMaskRe.test(i[t]))return!1;return!0},ip4AddressListText:"Invalid IPv4 Address(es).".t(),ip6Address:function(e){return this.mask.ip6AddrMaskRe.test(e)},ip6AddressText:"Invalid IPv6 Address.".t(),ipAddress:function(e){return this.mask.ip4AddrMaskRe.test(e)||this.mask.ip6AddrMaskRe.test(e)},ipAddressText:"Invalid IP Address.".t(),macAddress:function(e){return this.mask.macAddrMaskRe.test(e)},macAddressText:"Invalid Mac Address.".t(),cidrBlock:function(e){return/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\/\d{1,2}$/.test(e)},cidrBlockText:"Must be a network in CIDR format.".t()+" (192.168.123.0/24)",cidrBlockList:function(e){var t,i=e.split(",");for(t=0;t<i.length;t+=1)if(!/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\/\d{1,2}$/.test(i[t]))return!1;return!0},cidrBlockListText:"Must be a comma seperated list of networks in CIDR format.".t()+" (192.168.123.0/24,1.2.3.4/24)",cidrBlockArea:function(e){var t,i=e.split("\n");for(t=0;t<i.length;t+=1)if(!/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\/\d{1,2}$/.test(i[t]))return!1;return!0},cidrBlockAreaText:"Must be a one-per-line list of networks in CIDR format.".t()+" (192.168.123.0/24)",portMatcher:function(e){switch(e){case"any":return!0;default:return e.indexOf(">")!==-1&&e.indexOf(",")===-1?this.isSinglePortValid(e.substring(e.indexOf(">")+1)):e.indexOf("<")!==-1&&e.indexOf(",")===-1?this.isSinglePortValid(e.substring(e.indexOf("<")+1)):e.indexOf("-")===-1&&e.indexOf(",")===-1?this.isSinglePortValid(e):e.indexOf("-")!==-1&&e.indexOf(",")===-1?this.isPortRangeValid(e):this.isPortListValid(e)}},portMatcherText:Ext.String.format("The port must be an integer number between {0} and {1}.".t(),1,65535),port:function(e){var t=1,i=65535;return t<=e&&e<=i},portText:Ext.String.format("The port must be an integer number between {0} and {1} or one of the following values: any, all, n/a, none.".t(),1,65535)}),Ext.define("Ung.view.shd.Devices",{extend:"Ext.panel.Panel",xtype:"ung.devices",requires:[],viewModel:{data:{autoRefresh:!1}},layout:"border",defaults:{border:!1},title:"Devices".t(),items:[{region:"center",html:"devices"}]}),Ext.define("Ung.view.main.MainController",{extend:"Ext.app.ViewController",alias:"controller.main",control:{"#":{beforerender:"onBeforeRender"}},init:function(e){var t=e.getViewModel();t.set("reports",Ext.getStore("reports")),t.set("policyId",1)},onBeforeRender:function(e){var t=e.getViewModel();t.set("reportsInstalled",null!==rpc.nodeManager.node("untangle-node-reports")),rpc.nodeManager.node("untangle-node-reports")&&t.set("reportsRunning","RUNNING"===rpc.nodeManager.node("untangle-node-reports").getRunState()),t.notify(),e.getViewModel().set("policies",Ext.getStore("policies")),e.getViewModel().set("policy",Ext.getStore("policies").findRecord("policyId",1))},onDashboard:function(){console.log("on dashboard"),this.getViewModel().set("activeItem","dashboard")},onApps:function(e,t){console.log("on apps");var i=this.getViewModel();i.get("policyId");i.set("policyId",e),t?"install"===t?i.set("activeItem","appsinstall"):(i.set("nodeName",t),i.set("activeItem","settings")):i.set("activeItem","apps")},onConfig:function(e){this.getViewModel().set("activeItem","config");var t=this.getView();this.getViewModel().set("activeItem","config"),e?Ext.require("Ung.view.config.network.Network",function(){t.down("#config").add({xtype:"ung.config.network"}),t.down("#config").setActiveItem(1)}):t.down("#config").setActiveItem(0)},onReports:function(){this.getViewModel().set("activeItem","reports")},onSessions:function(){this.getViewModel().set("activeItem","sessions")},onHosts:function(){this.setShd("hosts")},onDevices:function(){this.setShd("devices")},setShd:function(e){this.getViewModel().set("activeItem","shd"),this.getViewModel().set("shdActiveItem",e),this.getView().down("#shdcenter").setActiveItem(e)}}),Ext.define("Ung.view.main.MainModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.main",data:{reportsInstalled:!1,reportsRunning:!1},formulas:{reportsEnabled:function(e){return e("reportsInstalled")&&e("reportsRunning")},isDashboard:function(e){return"dashboard"===e("activeItem")},isApps:function(e){return"apps"===e("activeItem")},isConfig:function(e){return"config"===e("activeItem")},isReports:function(e){return"reports"===e("activeItem")},isSessions:function(e){return"sessions"===e("shdActiveItem")},isHosts:function(e){return"hosts"===e("shdActiveItem")},isDevices:function(e){return"devices"===e("shdActiveItem")}}}),Ext.define("Ung.view.shd.SessionsController",{extend:"Ext.app.ViewController",alias:"controller.sessions",control:{"#":{afterrender:"getSessions",deactivate:"onDeactivate"},"#list":{select:"onSelect"},"toolbar textfield":{change:"globalFilter"}},refreshInterval:null,onDeactivate:function(e){e.destroy()},setAutoRefresh:function(e){var t=this,i=this.getViewModel();i.set("autoRefresh",e.pressed),console.log(e.pressed),e.pressed?(t.getSessions(),this.refreshInterval=setInterval(function(){t.getSessions()},5e3)):clearInterval(this.refreshInterval)},getSessions:function(){console.log("get sessions");var e=this,t=e.getView().down("#list");t.getView().setLoading(!0),Rpc.asyncData("rpc.sessionMonitor.getMergedSessions").then(function(e){t.getView().setLoading(!1),Ext.getStore("sessions").loadData(e.list),t.getSelectionModel().select(0)})},onSelect:function(e,t){var i=this.getViewModel(),n=t.getData();delete n._id,delete n.javaClass,delete n.mark,delete n.localAddr,delete n.remoteAddr,i.set("selectedSession",n)},globalFilter:function(e,t){var i=this.getView().down("#list"),n=new RegExp(t,"gi");t.length>0?(i.getStore().clearFilter(),i.getStore().filterBy(function(e){return n.test(e.get("protocol"))||n.test(e.get("preNatClient"))||n.test(e.get("postNatServer"))||n.test(e.get("preNatClientPort"))||n.test(e.get("postNatServerPort"))})):i.getStore().clearFilter(),i.getSelectionModel().select(0)}}),Ext.define("Ung.view.shd.Sessions",{extend:"Ext.panel.Panel",xtype:"ung.sessions",requires:["Ung.view.shd.SessionsController"],controller:"sessions",viewModel:{data:{autoRefresh:!1}},layout:"border",defaults:{border:!1},title:"Current Sessions".t(),items:[{region:"center",xtype:"grid",itemId:"list",store:"sessions",plugins:"gridfilters",columnLines:!0,columns:[{header:"Creation Time".t(),dataIndex:"creationTime",hidden:!0},{header:"Protocol".t(),dataIndex:"protocol",width:70,filter:{type:"list",options:["TCP","UDP"]}},{header:"Bypassed".t(),dataIndex:"bypassed",width:70},{header:"Policy".t(),dataIndex:"policy",hidden:!0},{header:"Hostname".t(),dataIndex:"platform-hostname",flex:1},{header:"NATd".t(),dataIndex:"natted",hidden:!0},{header:"Port Forwarded".t(),dataIndex:"portForwarded",hidden:!0},{header:"Username".t(),dataIndex:"platform-username",hidden:!0},{header:"Client".t(),columns:[{header:"Interface".t(),dataIndex:"clientIntf"},{header:"Pre-NAT".t(),dataIndex:"preNatClient"},{header:"Port (Pre-NAT)".t(),dataIndex:"preNatClientPort"},{header:"Post-NAT".t(),dataIndex:"postNatClient",hidden:!0},{header:"Port (Post-NAT)".t(),dataIndex:"postNatClientPort",hidden:!0},{header:"Country".t(),dataIndex:"clientCountry",hidden:!0},{header:"Latitude".t(),dataIndex:"clientLatitude",hidden:!0},{header:"Longitude".t(),dataIndex:"clientLlongitude",hidden:!0}]},{header:"Server".t(),columns:[{header:"Interface".t(),dataIndex:"serverIntf"},{header:"Pre-NAT".t(),dataIndex:"preNatServer",hidden:!0},{header:"Port (Pre-NAT)".t(),dataIndex:"preNatServerPort",hidden:!0},{header:"Post-NAT".t(),dataIndex:"postNatServer"},{header:"Port (Post-NAT)".t(),dataIndex:"postNatServerPort"},{header:"Country".t(),dataIndex:"serverCountry",hidden:!0},{header:"Latitude".t(),dataIndex:"serverLatitude",hidden:!0},{header:"Longitude".t(),dataIndex:"serverLlongitude",hidden:!0}]},{header:"Speed (KB/s)".t(),columns:[{header:"Client".t(),dataIndex:"clientKBps",filter:"number",align:"right"},{header:"Server".t(),dataIndex:"serverKBps",filter:"number",align:"right"},{header:"Total".t(),dataIndex:"totalKBps",filter:"number",align:"right"}]}]},{region:"east",xtype:"propertygrid",itemId:"details",editable:!1,width:400,title:"Session Details".t(),split:!0,collapsible:!0,resizable:!0,shadow:!1,animCollapse:!1,titleCollapse:!0,cls:"prop-grid",viewConfig:{stripeRows:!1,getRowClass:function(e){if(null===e.get("value")||""===e.get("value"))return"empty"}},nameColumnWidth:150,bind:{source:"{selectedSession}"},sourceConfig:{attachments:{displayName:"Attachments".t()},bypassed:{displayName:"Bypassed".t()},clientCountry:{displayName:"Client Country".t()},clientIntf:{displayName:"Client Interface".t()},clientKBps:{displayName:"Client KB/s".t()},clientLatitude:{displayName:"Client Latitude".t()},clientLongitude:{displayName:"Client Longitude".t()},creationTime:{displayName:"Creation Time".t()},hostname:{displayName:"Hostname".t()},natted:{displayName:"NATd".t()},pipeline:{displayName:"Pipeline".t()},policy:{displayName:"Policy".t()},portForwarded:{displayName:"Port Forwarded".t()},postNatClient:{displayName:"Client (Post-NAT)".t()},postNatClientPort:{displayName:"Client Port (Post-NAT)".t()},postNatServer:{displayName:"Server (Post-NAT)".t()},postNatServerPort:{displayName:"Server Port (Post-NAT)".t()},preNatClient:{displayName:"Client (Pre-NAT)".t()},preNatClientPort:{displayName:"Client Port (Pre-NAT)".t()},preNatServer:{displayName:"Server (Pre-NAT)".t()},preNatServerPort:{displayName:"Server Port (Pre-NAT)".t()},priority:{displayName:"Priority".t()},protocol:{displayName:"Protocol".t()},qosPriority:{displayName:"Priority".t()+"(QoS)"},serverCountry:{displayName:"Server Country".t()},serverIntf:{displayName:"Server Interface".t()},serverKBps:{displayName:"Server KB/s".t()},serverLatitude:{displayName:"Server Latitude".t()},serverLongitude:{displayName:"Server Longitude".t()},sessionId:{displayName:"Session ID".t()},state:{displayName:"State".t()},totalKBps:{displayName:"Total KB/s".t()}},listeners:{beforeedit:function(){return!1}}}],tbar:[{xtype:"button",text:"Refresh".t(),iconCls:"fa fa-repeat",handler:"getSessions",bind:{disabled:"{autoRefresh}"}},{xtype:"button",text:"Auto Refresh".t(),iconCls:"fa fa-refresh",enableToggle:!0,toggleHandler:"setAutoRefresh"},"-","Filter:".t(),{xtype:"textfield",checkChangeBuffer:200}]}),Ext.define("Ung.view.shd.HostsController",{extend:"Ext.app.ViewController",alias:"controller.hosts",control:{"#":{deactivate:"onDeactivate"},"#hostsgrid":{beforerender:"onBeforeRenderHostsGrid"}},onDeactivate:function(e){e.destroy()},onBeforeRenderHostsGrid:function(e){},getHosts:function(){console.log("get hosts");var e=this,t=e.getView().down("#hostsgrid");t.getView().setLoading(!0),Rpc.asyncData("rpc.hostTable.getHosts").then(function(e){t.getView().setLoading(!1),Ext.getStore("hosts").loadData(e.list)})}}),Ext.define("Ung.view.shd.Hosts",{extend:"Ext.tab.Panel",xtype:"ung.hosts",requires:["Ung.view.shd.HostsController"],controller:"hosts",layout:"border",defaults:{border:!1},items:[{xtype:"grid",itemId:"hostsgrid",title:"Current Hosts".t(),store:"hosts",columns:[{header:"IP".t(),dataIndex:"address"},{header:"MAC Address".t(),dataIndex:"macAddress"},{header:"MAC Vendor".t(),dataIndex:"macVendor"},{header:"Interface".t(),dataIndex:"interfaceId"},{header:"Last Access Time".t(),dataIndex:"lastAccessTimeDate",hidden:!0},{header:"Last Session Time".t(),dataIndex:"lastSessionTimeDate",hidden:!0},{header:"Last Completed TCP Session Time".t(),dataIndex:"lastCompletedTcpSessionTime",hidden:!0},{header:"Entitled Status".t(),dataIndex:"entitledStatus",hidden:!0},{header:"Active".t(),dataIndex:"active"},{header:"Hostname".t(),dataIndex:"hostname"},{header:"User Name".t(),dataIndex:"username"},{header:"Penalty".t(),columns:[{header:"Boxed".t(),dataIndex:"penaltyBoxed"},{header:"Entry Time".t(),dataIndex:"penaltyBoxEntryTime",hidden:!0},{header:"Exit Time".t(),dataIndex:"penaltyBoxExitTime",hidden:!0}]},{header:"Quota".t(),columns:[{header:"Size".t(),dataIndex:"quotaSize"},{header:"Remaining".t(),dataIndex:"quotaRemaining"},{header:"Issue Time".t(),dataIndex:"quotaIssueTime",hidden:!0},{header:"Expiration Time".t(),dataIndex:"quotaExpirationTime",hidden:!0}]}]},{title:"Penalty Box Hosts".t(),html:"penalty hosts"},{title:"Current Quotas".t(),html:"quotas"},{title:"Reports".t(),html:"reports"}]}),Ext.define("Ung.config.network.NetworkController",{extend:"Ext.app.ViewController",alias:"controller.config.network",control:{"#":{afterrender:"loadSettings"},"#interfaces":{beforerender:"onInterfaces"},"#portForwardRules":{beforerender:"setPortForwardWarnings"},"#currentRoutes":{afterrender:"refreshRoutes"},"#qosStatistics":{afterrender:"refreshQosStatistics"},"#upnpStatus":{afterrender:"refreshUpnpStatus"},"#dhcpLeases":{afterrender:"refreshDhcpLeases"},networktest:{afterrender:"networkTestRender"}},additionalInterfaceProps:[{v4Address:null,v4Netmask:null,v4Gateway:null,v4Dns1:null,v4Dns2:null,v4PrefixLength:null,v6Address:null,v6Gateway:null,v6PrefixLength:null,deviceName:null,macAddress:null,duplex:null,vendor:null,mbit:null,connected:null}],loadSettings:function(){var e=this,t=this.getView(),i=this.getViewModel();t.setLoading(!0),Ext.Deferred.sequence([Rpc.asyncPromise("rpc.networkManager.getNetworkSettings"),Rpc.asyncPromise("rpc.networkManager.getInterfaceStatus"),Rpc.asyncPromise("rpc.networkManager.getDeviceStatus")],this).then(function(n){t.setLoading(!1);var a,o;n[0].interfaces.list.forEach(function(t){Ext.apply(t,e.additionalInterfaceProps),a=Ext.Array.findBy(n[1].list,function(e){return e.interfaceId===t.interfaceId}),delete a.javaClass,Ext.apply(t,a),o=Ext.Array.findBy(n[2].list,function(e){return e.deviceName===t.physicalDev}),delete o.javaClass,Ext.apply(t,o)}),i.set("settings",n[0])},function(e){t.setLoading(!1),console.error(e),Util.exceptionToast(e)})},saveSettings:function(){var e=this.getView(),t=this.getViewModel(),i=this;Util.validateForms(e)&&(e.setLoading("Saving ..."),e.query("ungrid").forEach(function(e){var i=e.getStore();(i.getModifiedRecords().length>0||i.isReordered)&&(i.each(function(e){e.get("markedForDelete")&&e.drop()}),i.isReordered=void 0,t.set(e.listProperty,Ext.Array.pluck(i.getRange(),"data")))}),Rpc.asyncData("rpc.networkManager.setNetworkSettings",t.get("settings")).then(function(t){e.setLoading(!1),i.loadSettings(),Util.successToast("Network".t()+" settings saved!")}))},onInterfaces:function(){var e=this,t=this.getViewModel();t.bind("{interfacesGrid.selection}",function(t){t&&(e.getInterfaceStatus(),e.getInterfaceArp())})},getInterfaceStatus:function(){var e=this.getView().down("#interfaceStatus"),t=this.getViewModel(),i=t.get("interfacesGrid.selection").get("symbolicDev"),n="ifconfig "+i+' | grep "Link\\|packets" | grep -v inet6 | tr "\\n" " " | tr -s " " ',a="ifconfig "+i+' | grep "inet addr" | tr -s " " | cut -c 7- ',o="ifconfig "+i+' | grep inet6 | grep Global | cut -d" " -f 13',r={device:i,macAddress:null,address:null,mask:null,v6Addr:null,rxpkts:null,rxerr:null,rxdrop:null,txpkts:null,txerr:null,txdrop:null};e.setLoading(!0),Rpc.asyncData("rpc.execManager.execOutput",n).then(function(i){if(Ext.isEmpty(i)||i.search("Device not found")>=0)return void e.setLoading(!1);var n=i.split(" ");i.search("Ethernet")>=0&&Ext.apply(r,{macAddress:n[4],rxpkts:n[6].split(":")[1],rxerr:n[7].split(":")[1],rxdrop:n[8].split(":")[1],txpkts:n[12].split(":")[1],txerr:n[13].split(":")[1],txdrop:n[14].split(":")[1]}),i.search("Point-to-Point")>=0&&Ext.apply(r,{macAddress:"",rxpkts:n[5].split(":")[1],rxerr:n[6].split(":")[1],rxdrop:n[7].split(":")[1],txpkts:n[11].split(":")[1],txerr:n[12].split(":")[1],txdrop:n[13].split(":")[1]}),Rpc.asyncData("rpc.execManager.execOutput",a).then(function(i){if(Ext.isEmpty(i))return void e.setLoading(!1);var n=i.split(" ");Ext.apply(r,{address:n[0].split(":")[1],mask:n[2].split(":")[1]}),Rpc.asyncData("rpc.execManager.execOutput",o).then(function(i){e.setLoading(!1),Ext.apply(r,{v6Addr:i}),t.set("siStatus",r)})})})},getInterfaceArp:function(){var e=this.getViewModel(),t=this.getView().down("#interfaceArp"),i=e.get("interfacesGrid.selection").get("symbolicDev"),n="arp -n | grep "+i+" | grep -v incomplete > /tmp/arp.txt ; cat /tmp/arp.txt";t.setLoading(!0),Rpc.asyncData("rpc.execManager.execOutput",n).then(function(i){for(var n,a=Ext.isEmpty(i)?[]:i.split("\n"),o=[],r=0;r<a.length;r++)Ext.isEmpty(a[r])||(n=a[r].split(/\s+/),o.push({address:n[0],type:n[1],macAddress:n[2]}));e.set("siArp",o),t.setLoading(!1)})},setPortForwardWarnings:function(){var e,t,i=this.getViewModel(),n=i.get("settings.interfaces.list"),a=[];for(t=0;t<n.length;t+=1)e=n[t],e.v4Address&&a.push(Ext.String.format("<b>{0}:{1}</b> ",e.v4Address,i.get("settings.httpsPort"))+"for HTTPS services.".t()+"<br/>");for(t=0;t<n.length;t+=1)e=n[t],e.v4Address&&!e.isWan&&a.push(Ext.String.format("<b>{0}:{1}</b> ",e.v4Address,i.get("settings.httpPort"))+"for HTTP services.".t()+"<br/>");for(t=0;t<n.length;t+=1)if(e=n[t],e.v4Address&&e.isWan)for(var o=0;o<n.length;o++){var r=n[o];"BRIDGED"===r.configType&&r.bridgedTo===e.interfaceId&&a.push(Ext.String.format("<b>{0}:{1}</b> ",e.v4Address,i.get("settings.httpPort"))+"on".t()+Ext.String.format(" {2} ",r.name)+"for HTTP services.".t()+"<br/>")}i.set("portForwardWarnings",a.join(""))},refreshRoutes:function(e){var t=e.isXType("button")?e.up("panel"):e;t.down("textarea").setValue(""),t.setLoading(!0),Rpc.asyncData("rpc.execManager.exec","/usr/share/untangle/bin/ut-routedump.sh").then(function(e){t.down("textarea").setValue(e.output)}).always(function(){t.setLoading(!1)})},refreshQosStatistics:function(cmp){var view=cmp.isXType("button")?cmp.up("grid"):cmp;view.setLoading(!0),Rpc.asyncData("rpc.execManager.execOutput","/usr/share/untangle-netd/bin/qos-service.py status").then(function(result){var list=[];try{list=eval(result)}catch(e){Util.exceptionToast("Unable to get QoS statistics"),console.error("Could not execute /usr/share/untangle-netd/bin/qos-service.py output: ",result,e)}}).always(function(){view.setLoading(!1)})},refreshUpnpStatus:function(e){var t=e.isXType("button")?e.up("grid"):e;if(!t.isDisabled()){t.setLoading(!0);var i=this.getViewModel();Rpc.asyncData("rpc.networkManager.getUpnpManager","--status","").then(function(e){console.log(e),i.set("upnpStatus",Ext.decode(e).active)}).always(function(){t.setLoading(!1)})}},refreshDhcpLeases:function(e){var t=e.isXType("button")?e.up("grid"):e;t.setLoading(!0),Rpc.asyncData("rpc.execManager.execOutput","cat /var/lib/misc/dnsmasq.leases").then(function(e){var t,i,n=e.split("\n"),a=[];for(i=0;i<n.length;i++)null!==n[i]&&""!==n[i]&&(t=n[i].split(/\s+/),a.push({date:t[0],macAddress:t[1],address:t[2],hostname:t[3],clientId:t[4]}))}).always(function(){t.setLoading(!1)})},networkTestRender:function(e){e.down("form").insert(0,e.commandFields)},runTest:function(e){console.log(e);var t=e.up("networktest"),i=t.down("textarea"),n=[],a=this;e.setDisabled(!0),n.push(i.getValue()),n.push(""+new Date+" - "+"Test Started".t()+"\n"),rpc.execManager.execEvil(function(t,o){return o?(console.error(o),void Util.exceptionToast(o)):void a.readOutput(t,n,i,e)},t.getViewModel().get("command"));
},readOutput:function(e,t,i,n){var a=this;e&&e.readFromOutput(function(o,r){return r?(console.error(r),void Util.exceptionToast(r)):(null!==o?(t.push(o),Ext.Function.defer(a.readOutput,1e3,a,[e,t,i,n])):(n.setDisabled(!1),t.push(""+new Date+" - "+"Test Completed".t()),t.push("\n\n--------------------------------------------------------\n\n")),i.setValue(t.join("")),void(i.getEl().down("textarea").dom.scrollTop=99999))})},clearOutput:function(e){var t=e.up("networktest");t.down("textarea").setValue("")},editInterface:function(e){var t=this.getView();this.getViewModel();this.dialog=t.add({xtype:"config.interface",viewModel:{data:{si:e.getWidgetRecord()},formulas:{isAddressed:function(e){return"ADDRESSED"===e("si.configType")},isDisabled:function(e){return"DISABLED"===e("si.configType")},isBridged:function(e){return"BRIDGED"===e("si.configType")},isStaticv4:function(e){return"STATIC"===e("si.v4ConfigType")},isAutov4:function(e){return"AUTO"===e("si.v4ConfigType")},isPPPOEv4:function(e){return"PPPOE"===e("si.v4ConfigType")},isDisabledv6:function(e){return"DISABLED"===e("si.v6ConfigType")},isStaticv6:function(e){return"STATIC"===e("si.v6ConfigType")},isAutov6:function(e){return"AUTO"===e("si.v6ConfigType")},showRouterWarning:function(e){return 64!==e("si.v6StaticPrefixLength")},showWireless:function(e){return e("si.isWirelessInterface")&&"DISABLED"!==e("si.configType")},showWirelessPassword:function(e){return"NONE"!==e("si.wirelessEncryption")&&null!==e("si.wirelessEncryption")}}}}),this.dialog.show()},cancelEdit:function(){this.dialog.close()},doneEdit:function(){this.dialog.close()}}),Ext.define("Ung.config.network.NetworkModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.config.network",formulas:{si:function(e){return e("interfacesGrid.selection")},fullHostName:function(e){var t=e("settings.domainName"),i=e("settings.hostName");return null!==t&&""!==t?i+"."+t:i},qosPriorityNoDefaultStore:function(e){return e("qosPriorityStore").slice(1)}},data:{settings:null,siStatus:null,siArp:null,qosPriorityStore:[[0,"Default".t()],[1,"Very High".t()],[2,"High".t()],[3,"Medium".t()],[4,"Low".t()],[5,"Limited".t()],[6,"Limited More".t()],[7,"Limited Severely".t()]],upnpStatus:null},stores:{interfaces:{data:"{settings.interfaces.list}"},interfaceArp:{data:"{siArp}"},portForwardRules:{data:"{settings.portForwardRules.list}"},natRules:{data:"{settings.natRules.list}"},bypassRules:{data:"{settings.bypassRules.list}"},staticRoutes:{data:"{settings.staticRoutes.list}"},staticDnsEntries:{data:"{settings.dnsSettings.staticEntries.list}"},localServers:{data:"{settings.dnsSettings.localServers.list}"},staticDhcpEntries:{data:"{settings.staticDhcpEntries.list}"},devices:{data:"{settings.devices.list}"},qosPriorities:{data:"{settings.qosSettings.qosPriorities.list}"},qosRules:{data:"{settings.qosSettings.qosRules.list}"},forwardFilterRules:{data:"{settings.forwardFilterRules.list}"},inputFilterRules:{data:"{settings.inputFilterRules.list}"},upnpRules:{data:"{settings.upnpSettings.upnpRules.list}"},wanInterfaces:{source:"{interfaces}",filters:[{property:"configType",value:"ADDRESSED"},{property:"isWan",value:!0}]}}}),Ext.define("Ung.config.network.Interface",{extend:"Ext.window.Window",alias:"widget.config.interface",width:500,height:550,layout:"fit",modal:!0,title:"Config".t(),items:[{xtype:"form",border:!1,scrollable:"vertical",bodyPadding:10,layout:{type:"vbox",align:"stretch"},defaults:{labelWidth:200,labelAlign:"right"},items:[{xtype:"textfield",fieldLabel:"Interface Name".t(),labelAlign:"top",name:"interfaceName",allowBlank:!1,bind:"{si.name}"},{xtype:"combo",allowBlank:!1,editable:!1,bind:{value:"{si.vlanParent}",hidden:"{!si.isVlanInterface || isDisabled}"},hidden:!0,fieldLabel:"Parent Interface".t(),queryMode:"local"},{xtype:"numberfield",bind:{value:"{si.vlanTag}",hidden:"{!si.isVlanInterface || isDisabled}"},hidden:!0,fieldLabel:"802.1q Tag".t(),minValue:1,maxValue:4096,allowBlank:!1},{xtype:"segmentedbutton",allowMultiple:!1,bind:"{si.configType}",margin:"10 12",items:[{text:"Addressed".t(),value:"ADDRESSED"},{text:"Bridged".t(),value:"BRIDGED"},{text:"Disabled".t(),value:"DISABLED"}]},{xtype:"combo",allowBlank:!1,editable:!1,hidden:!0,bind:{value:"{si.bridgedTo}",hidden:"{!isBridged}"},fieldLabel:"Bridged To".t(),queryMode:"local"},{xtype:"checkbox",fieldLabel:"Is WAN Interface".t(),hidden:!0,bind:{value:"{si.isWan}",hidden:"{!isAddressed}"}},{xtype:"fieldset",width:"100%",title:"Wireless Configuration".t(),collapsible:!0,defaults:{labelWidth:190,labelAlign:"right",anchor:"100%"},hidden:!0,bind:{hidden:"{!showWireless || !isAddressed}"},items:[{xtype:"textfield",fieldLabel:"SSID".t(),bind:"{si.wirelessSsid}",allowBlank:!1,disableOnly:!0,maxLength:30,maskRe:/[a-zA-Z0-9\-_=]/},{xtype:"combo",fieldLabel:"Encryption".t(),bind:"{si.wirelessEncryption}",editable:!1,store:[["NONE","None".t()],["WPA1","WPA".t()],["WPA12","WPA / WPA2".t()],["WPA2","WPA2".t()]],queryMode:"local"},{xtype:"textfield",bind:{value:"{si.wirelessPassword}",hidden:"{!showWirelessPassword}"},fieldLabel:"Password".t(),allowBlank:!1,disableOnly:!0,maxLength:63,minLength:8,maskRe:/[a-zA-Z0-9~@#%_=,\!\-\/\?\(\)\[\]\\\^\$\+\*\.\|]/},{xtype:"combo",bind:"{si.wirelessChannel}",fieldLabel:"Channel".t(),editable:!1,valueField:"channel",displayField:"channelDescription",queryMode:"local"}]},{xtype:"fieldset",title:"IPv4 Configuration".t(),collapsible:!0,defaults:{labelWidth:190,labelAlign:"right",anchor:"100%"},hidden:!0,bind:{hidden:"{!isAddressed}"},items:[{xtype:"segmentedbutton",allowMultiple:!1,bind:{value:"{si.v4ConfigType}",hidden:"{!si.isWan}"},margin:"10 0",items:[{text:"Auto (DHCP)".t(),value:"AUTO"},{text:"Static".t(),value:"STATIC"},{text:"PPPoE".t(),value:"PPPOE"}]},{xtype:"textfield",bind:{value:"{si.v4StaticAddress}",hidden:"{!isStaticv4}"},fieldLabel:"Address".t(),allowBlank:!1},{xtype:"combo",bind:{value:"{si.v4StaticPrefix}",hidden:"{!isStaticv4}"},fieldLabel:"Netmask".t(),allowBlank:!1,editable:!1,store:Util.v4NetmaskList,queryMode:"local"},{xtype:"textfield",bind:{value:"{si.v4StaticGateway}",hidden:"{!si.isWan || !isStaticv4}"},fieldLabel:"Gateway".t(),allowBlank:!1},{xtype:"textfield",bind:{value:"{si.v4StaticDns1}",hidden:"{!si.isWan || !isStaticv4}"},fieldLabel:"Primary DNS".t(),allowBlank:!1},{xtype:"textfield",bind:{value:"{si.v4StaticDns2}",hidden:"{!si.isWan || !isStaticv4}"},fieldLabel:"Secondary DNS".t()},{xtype:"textfield",bind:{value:"{si.v4AutoAddressOverride}",emptyText:"{si.v4Address}",hidden:"{!isAutov4}"},fieldLabel:"Address Override".t()},{xtype:"combo",bind:{value:"{si.v4AutoPrefixOverride}",hidden:"{!isAutov4}"},editable:!1,fieldLabel:"Netmask Override".t(),store:Util.v4NetmaskList,queryMode:"local"},{xtype:"textfield",bind:{value:"{si.v4AutoGatewayOverride}",emptyText:"{si.v4Gateway}",hidden:"{!isAutov4}"},fieldLabel:"Gateway Override".t()},{xtype:"textfield",bind:{value:"{si.v4AutoDns1Override}",emptyText:"{si.v4Dns1}",hidden:"{!isAutov4}"},fieldLabel:"Primary DNS Override".t()},{xtype:"textfield",bind:{value:"{si.v4AutoDns2Override}",emptyText:"{si.v4Dns2}",hidden:"{!isAutov4}"},fieldLabel:"Secondary DNS Override".t()},{xtype:"button",text:"Renew DHCP Lease".t(),margin:"0 0 15 200",bind:{hidden:"{!isAutov4}"}},{xtype:"textfield",bind:{value:"{si.v4PPPoEUsername}",hidden:"{!isPPPOEv4}"},fieldLabel:"Username".t()},{xtype:"textfield",inputType:"password",bind:{value:"{si.v4PPPoEPassword}",hidden:"{!isPPPOEv4}"},fieldLabel:"Password".t()},{xtype:"checkbox",bind:{value:"{si.v4PPPoEUsePeerDns}",hidden:"{!isPPPOEv4}"},fieldLabel:"Use Peer DNS".t()},{xtype:"textfield",bind:{value:"{si.v4PPPoEDns1}",hidden:"{!isPPPOEv4 || si.v4PPPoEUsePeerDns}"},fieldLabel:"Primary DNS".t()},{xtype:"textfield",bind:{value:"{si.v4PPPoEDns2}",hidden:"{!isPPPOEv4 || si.v4PPPoEUsePeerDns}"},fieldLabel:"Secondary DNS".t()},{xtype:"fieldset",title:"IPv4 Options".t(),items:[{xtype:"checkbox",bind:{value:"{si.v4NatEgressTraffic}",hidden:"{!si.isWan}"},boxLabel:"NAT traffic exiting this interface (and bridged peers)".t()},{xtype:"checkbox",bind:{value:"{si.v4NatIngressTraffic}",hidden:"{si.isWan}"},boxLabel:"NAT traffic coming from this interface (and bridged peers)".t()}]}]},{xtype:"fieldset",title:"IPv6 Configuration".t(),collapsible:!0,defaults:{xtype:"textfield",labelWidth:190,labelAlign:"right",anchor:"100%"},hidden:!0,bind:{hidden:"{!isAddressed}",collapsed:"{isDisabledv6}"},items:[{xtype:"segmentedbutton",allowMultiple:!1,bind:{value:"{si.v6ConfigType}",hidden:"{!si.isWan}"},margin:"10 0",items:[{text:"Disabled".t(),value:"DISABLED"},{text:"Auto (SLAAC/RA)".t(),value:"AUTO"},{text:"Static".t(),value:"STATIC"}]},{bind:{value:"{si.v6StaticAddress}",hidden:"{isDisabledv6 || isAutov6}"},fieldLabel:"Address".t()},{bind:{value:"{si.v6StaticPrefixLength}",hidden:"{isDisabledv6 || isAutov6}"},fieldLabel:"Prefix Length".t()},{bind:{value:"{si.v6StaticGateway}",hidden:"{isDisabledv6 || isAutov6 || !si.isWan}"},fieldLabel:"Gateway".t()},{bind:{value:"{si.v6StaticDns1}",hidden:"{isDisabledv6 || isAutov6 || !si.isWan}"},fieldLabel:"Primary DNS".t()},{bind:{value:"{si.v6StaticDns2}",hidden:"{isDisabledv6 || isAutov6 || !si.isWan}"},fieldLabel:"Secondary DNS".t()},{xtype:"fieldset",title:"IPv6 Options".t(),bind:{hidden:"{isDisabledv6 || isAutov6 || si.isWan}"},items:[{xtype:"checkbox",bind:{value:"{si.raEnabled}"},boxLabel:"Send Router Advertisements".t()},{xtype:"label",style:{fontSize:"10px"},html:'<span style="color: red">'+"Warning:".t()+"</span> "+"SLAAC only works with /64 subnets.".t(),bind:{hidden:"{!showRouterWarning}"}}]}]},{xtype:"fieldset",title:"DHCP Configuration",collapsible:!0,defaults:{labelWidth:190,labelAlign:"right",anchor:"100%"},hidden:!0,bind:{hidden:"{!isAddressed || si.isWan}"},items:[{xtype:"checkbox",bind:"{si.dhcpEnabled}",boxLabel:"Enable DHCP Serving".t()},{xtype:"textfield",bind:{value:"{si.dhcpRangeStart}",hidden:"{!si.dhcpEnabled}"},fieldLabel:"Range Start".t(),allowBlank:!1,disableOnly:!0},{xtype:"textfield",bind:{value:"{si.dhcpRangeEnd}",hidden:"{!si.dhcpEnabled}"},fieldLabel:"Range End".t(),allowBlank:!1,disableOnly:!0},{xtype:"numberfield",bind:{value:"{si.dhcpLeaseDuration}",hidden:"{!si.dhcpEnabled}"},fieldLabel:"Lease Duration".t()+" "+"(seconds)".t(),allowDecimals:!1,allowBlank:!1,disableOnly:!0},{xtype:"fieldset",title:"DHCP Advanced".t(),collapsible:!0,collapsed:!0,defaults:{labelWidth:180,labelAlign:"right",anchor:"100%"},bind:{hidden:"{!si.dhcpEnabled}"},items:[{xtype:"textfield",bind:"{si.dhcpGatewayOverride}",fieldLabel:"Gateway Override".t()},{xtype:"combo",bind:"{si.dhcpPrefixOverride}",fieldLabel:"Netmask Override".t(),editable:!1,store:Util.v4NetmaskList,queryMode:"local"},{xtype:"textfield",bind:"{si.dhcpDnsOverride}",fieldLabel:"DNS Override".t()}]}]},{xtype:"fieldset",title:"Redundancy (VRRP) Configuration".t(),collapsible:!0,defaults:{labelWidth:190,labelAlign:"right",anchor:"100%"},hidden:!0,bind:{hidden:"{!isAddressed || !isStaticv4}"},items:[{xtype:"checkbox",bind:"{si.vrrpEnabled}",boxLabel:"Enable VRRP".t()},{xtype:"numberfield",bind:{value:"{si.vrrpId}",hidden:"{!si.vrrpEnabled}"},fieldLabel:"VRRP ID".t(),minValue:1,maxValue:255,allowBlank:!1,blankText:"VRRP ID must be a valid integer between 1 and 255.".t()},{xtype:"numberfield",bind:{value:"{si.vrrpPriority}",hidden:"{!si.vrrpEnabled}"},fieldLabel:"VRRP Priority".t(),minValue:1,maxValue:255,allowBlank:!1,blankText:"VRRP Priority must be a valid integer between 1 and 255.".t()}]}],buttons:[{text:"Cancel",iconCls:"fa fa-ban fa-red",handler:"cancelEdit"},{text:"Done",iconCls:"fa fa-check",handler:"doneEdit"}]}]}),Ext.define("Ung.model.Rule",{extend:"Ext.data.Model",alias:"model.rule",fields:[{name:"markedForDelete",defaultValue:!1},{name:"markedForNew",defaultValue:!1}],proxy:{type:"memory",reader:{type:"json"}}}),Ext.define("Ung.store.Rule",{extend:"Ext.data.Store",storeId:"rule",alias:"store.rule",model:"Ung.model.Rule"}),Ext.define("Ung.view.dashboard.DashboardController",{extend:"Ext.app.ViewController",alias:"controller.dashboard",viewModel:!0,control:{"#":{}},listen:{global:{init:"loadWidgets",nodeinstall:"onNodeInstall",removewidget:"onRemoveWidget",addwidget:"onAddWidget",reportsInstall:"loadWidgets"},store:{"#stats":{datachanged:"onStatsUpdate"},"#widgets":{},"#reports":{}}},init:function(e){var t=e.getViewModel();t.set("managerOpen",!1)},onInit:function(){console.log("oninit")},initDashboard:function(){var e=this;e.getViewModel()},loadWidgets:function(){var e,t,i,n=this.getViewModel(),a=this.getView().lookupReference("dashboard"),o=Ext.getStore("widgets").getRange();for(this.getView().lookupReference("dashboardNav").getView().refresh(),a.removeAll(!0),e=0;e<o.length;e+=1)t=o[e],"ReportEntry"!==t.get("type")?a.add({xtype:t.get("type").toLowerCase()+"widget",itemId:t.get("type"),viewModel:{data:{widget:t}}}):n.get("reportsEnabled")?(i=Ext.getStore("reports").findRecord("uniqueId",t.get("entryId")),i&&!Ext.getStore("unavailableApps").first().get(i.get("category"))&&t.get("enabled")?a.add({xtype:"reportwidget",itemId:t.get("entryId"),refreshIntervalSec:t.get("refreshIntervalSec"),viewModel:{data:{widget:t,entry:i}}}):a.add({xtype:"component",itemId:t.get("entryId"),hidden:!0})):a.add({xtype:"component",itemId:t.get("entryId"),hidden:!0});console.timeEnd("all")},onNodeInstall:function(e,t){this.getView().lookupReference("dashboardNav").getView().refresh();var i,n,a,o=this.getView().lookupReference("dashboard"),r=Ext.getStore("widgets").getRange();for(a=0;a<r.length;a+=1)i=r[a],n=Ext.getStore("reports").findRecord("uniqueId",i.get("entryId")),n&&n.get("category")===t.displayName&&(o.remove(i.get("entryId")),"install"===e?o.insert(a,{xtype:"reportwidget",itemId:i.get("entryId"),refreshIntervalSec:i.get("refreshIntervalSec"),viewModel:{data:{widget:i,entry:n}}}):o.insert(a,{xtype:"component",itemId:i.get("entryId"),hidden:!0}))},enableRenderer:function(e,t,i){var n=this.getViewModel();if("ReportEntry"!==i.get("type"))return'<i class="fa '+(e?"fa-check-circle-o":"fa-circle-o")+' fa-lg"></i>';var a=Ext.getStore("reports").findRecord("uniqueId",i.get("entryId"));return a&&!Ext.getStore("unavailableApps").first().get(a.get("category"))&&n.get("reportsRunning")?'<i class="fa '+(e?"fa-check-circle-o":"fa-circle-o")+' fa-lg"></i>':'<i class="fa fa-info-circle fa-lg" style="color: #a91f1f;"></i>'},settingsRenderer:function(){},widgetTitleRenderer:function(e,t,i){var n,a,o,r,s=this.getViewModel();return r=i.get("enabled"),e?s.get("reportsInstalled")?(n=Ext.getStore("reports").findRecord("uniqueId",e),n?(o=Ext.getStore("unavailableApps").first().get(n.get("category")),a='<span style="font-weight: 700; '+(o||!r?"color: #999;":"")+'">'+(n.get("readOnly")?n.get("title").t():n.get("title"))+"</span>",n.get("timeDataInterval")&&"AUTO"!==n.get("timeDataInterval")&&(a+='<span style="text-transform: lowercase; color: #999; font-weight: 300;"> per '+n.get("timeDataInterval")+"</span>"),a):"Some "+"Widget".t()):'<span style="color: #999; line-height: 26px;">'+"App Widget".t()+"</span>":'<span style="font-weight: 700; '+(r?"":"color: #999;")+'">'+i.get("type")+"</span>"},applyChanges:function(){console.log("apply"),Ung.dashboardSettings.widgets.list=Ext.Array.pluck(Ext.getStore("widgets").getRange(),"data"),Rpc.asyncData("rpc.dashboardManager.setSettings",Ung.dashboardSettings).then(function(e){Util.successToast('<span style="color: yellow; font-weight: 600;">Dashboard Saved!</span>'),Ext.getStore("widgets").sync()})},managerHandler:function(){var e=this.getViewModel().get("managerOpen");this.getViewModel().set("managerOpen",!e)},onItemClick:function(e,t,i,n,a,o){var r,s,d=this,l=d.getView().lookupReference("dashboard"),c=this.getViewModel();if(1===i)if("ReportEntry"!==n.get("type"))n.set("enabled",!n.get("enabled"));else{if(!c.get("reportsInstalled"))return void Ext.Msg.alert("Install required".t(),"To enable App Widgets please install Reports first!".t());if(!c.get("reportsRunning"))return void Ext.Msg.alert("Reports".t(),"To view App Widgets enable the Reports App first!".t());r=Ext.getStore("reports").findRecord("uniqueId",n.get("entryId")),s=l.down("#"+n.get("entryId")),r&&s?Ext.getStore("unavailableApps").first().get(r.get("category"))?Ext.Msg.alert("Install required".t(),Ext.String.format("To enable this Widget please install <strong>{0}</strong> app first!".t(),r.get("category"))):(s.destroy(),n.get("enabled")?l.insert(o,{xtype:"component",itemId:n.get("entryId"),hidden:!0}):(l.insert(o,{xtype:"reportwidget",itemId:n.get("entryId"),refreshIntervalSec:n.get("refreshIntervalSec"),viewModel:{data:{widget:n,entry:r}}}),s=l.down("#"+n.get("entryId")),setTimeout(function(){l.scrollTo(0,l.getEl().getScrollTop()+s.getEl().getY()-121,{duration:300})},100)),n.set("enabled",!n.get("enabled"))):Util.exceptionToast("This entry is not available and it should be removed!")}2===i&&(s=l.down("#"+n.get("entryId"))||l.down("#"+n.get("type")),s&&!s.isHidden()&&(l.addCls("highlight"),s.addCls("highlight-item"),l.scrollTo(0,l.getEl().getScrollTop()+s.getEl().getY()-121,{duration:500})))},removeWidget:function(e,t,i,n,a,o){o.drop()},onItemLeave:function(e,t){this.tout&&window.clearTimeout(this.tout);var i,n=this.getView().lookupReference("dashboard");i="ReportEntry"!==t.get("type")?n.down("#"+t.get("type")):n.down("#"+t.get("entryId")),i&&(n.removeCls("highlight"),i.removeCls("highlight-item"))},onDrop:function(e,t,i,n){var a=this.getView().lookupReference("dashboard"),o=this.getView().down("#"+t.records[0].get("entryId"))||this.getView().down("#"+t.records[0].get("type")),r=this.getView().down("#"+i.get("entryId"))||this.getView().down("#"+i.get("type"));"before"===n?a.moveBefore(o,r):a.moveAfter(o,r)},resetDashboard:function(){this.getViewModel();Ext.MessageBox.confirm("Warning".t(),"This will overwrite the current dashboard settings with the defaults.".t()+"<br/><br/>"+"Do you want to continue?".t(),function(e){"yes"===e&&Rpc.asyncData("rpc.dashboardManager.resetSettingsToDefault").then(function(e){Util.successToast("Dashboard reset done!")})})},onRemoveWidget:function(e){var t=this.getView().lookupReference("dashboard");t.down("#"+e)&&t.remove(e)},onAddWidget:function(e,t){var i=this.getView().lookupReference("dashboard");t?i.add({xtype:"reportwidget",itemId:e.get("entryId"),refreshIntervalSec:e.get("refreshIntervalSec"),viewModel:{data:{widget:e,entry:t}}}):(console.log(e),i.add({xtype:e.get("type").toLowerCase()+"widget",itemId:e.get("type"),viewModel:{data:{widget:e}}}))},onStatsUpdate:function(){var e=this.getViewModel();e.set("stats",Ext.getStore("stats").first()),rpc.deviceTable.getDevices(function(t,i){return i?(Util.exceptionToast(i),!1):void e.set("deviceCount",t.list.length)})},populateMenus:function(){var e,t=this.getView().down("#addWidgetBtn"),i=[],n=[];t.getMenu()&&t.getMenu().remove(),i.push({text:"Common",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_hosts.png",iconCls:"menu-icon",menu:{plain:!0,items:[{text:"Information",type:"Information"},{text:"Resources",type:"Resources"},{text:"CPU Load",type:"CPULoad"},{text:"Network Information",type:"NetworkInformation"},{text:"Network Layout",type:"NetworkLayout"},{text:"Map Distribution",type:"MapDistribution"}],listeners:{click:function(e,t){if(Ext.getStore("widgets").findRecord("type",t.type))return void Util.successToast('<span style="color: yellow; font-weight: 600;">'+t.text+"</span> is already in Dashboard!");var i=Ext.create("Ung.model.Widget",{displayColumns:null,enabled:!0,entryId:null,javaClass:"com.untangle.uvm.DashboardWidgetSettings",refreshIntervalSec:0,timeframe:null,type:t.type});Ext.getStore("widgets").add(i),Ext.GlobalEvents.fireEvent("addwidget",i,null)}}}}),rpc.reportsManager?Rpc.asyncData("rpc.reportsManager.getCurrentApplications").then(function(a,o){e=[{displayName:"Hosts",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_hosts.png"},{displayName:"Devices",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_devices.png"},{displayName:"Network",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_network.png"},{displayName:"Administration",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_admin.png"},{displayName:"System",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_system.png"},{displayName:"Shield",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/apps/untangle-node-shield_17x17.png"}],a.list.forEach(function(t){e.push({displayName:t.displayName,icon:resourcesBaseHref+"/skins/modern-rack/images/admin/apps/"+t.name+"_17x17.png"})}),e.forEach(function(e){n=[],Ext.getStore("reports").filter({property:"category",value:e.displayName,exactMatch:!0}),Ext.getStore("reports").getRange().forEach(function(e){n.push({text:Util.iconReportTitle(e)+" "+e.get("title"),report:e})}),Ext.getStore("reports").clearFilter(),i.push({text:e.displayName,icon:e.icon,iconCls:"menu-icon",menu:{plain:!0,items:n,listeners:{click:function(e,t){if(Ext.getStore("widgets").findRecord("entryId",t.report.get("uniqueId")))return void Util.successToast('<span style="color: yellow; font-weight: 600;">'+t.report.get("title")+"</span> is already in Dashboard!");var i=Ext.create("Ung.model.Widget",{displayColumns:t.report.get("displayColumns"),enabled:!0,entryId:t.report.get("uniqueId"),javaClass:"com.untangle.uvm.DashboardWidgetSettings",refreshIntervalSec:60,timeframe:3600,type:"ReportEntry"});Ext.getStore("widgets").add(i),Ext.GlobalEvents.fireEvent("addwidget",i,t.report)}}}})}),t.setMenu({items:i,mouseLeaveDelay:0})}):t.setMenu({items:i,mouseLeaveDelay:0})}}),Ext.define("Ung.view.dashboard.Queue",{alternateClassName:"DashboardQueue",singleton:!0,processing:!1,paused:!1,queue:[],queueMap:{},tout:null,add:function(e){this.queueMap[e.id]||(this.queue.push(e),this.process())},addFirst:function(e){this.queueMap[e.id]||(this.queue.unshift(e),this.process())},next:function(){this.processing=!1,this.process()},remove:function(e){console.log("removing"),this.processing&&(this.processing=!1)},process:function(){var e=this;if(clearTimeout(this.tout),this.tout=setTimeout(function(){e.processing=!1,e.queue=[]},3e3),!this.paused&&!this.processing&&this.queue.length>0){this.processing=!0;var t=this.queue.shift();delete this.queueMap[t.id],t.isHidden()?(t.toQueue=!0,Ung.view.dashboard.Queue.next()):t.fetchData()}},reset:function(){this.queue=[],this.queueMap={},this.processing=!1},pause:function(){this.paused=!0},resume:function(){this.paused=!1,this.process()},inView:function(e){if(!e.getEl())return!1;var t=e.getEl().dom.getBoundingClientRect();return t.top+t.height/2>0&&t.height/2+t.top<window.innerHeight}}),Ext.define("Ung.widget.WidgetController",{extend:"Ext.app.ViewController",alias:"controller.widget",control:{"#":{afterrender:"onAfterRender",afterdata:"onAfterData",beforedestroy:"onBeforeRemove"},"#header":{render:"headerRender"}},listen:{},headerRender:function(e){var t=this;e.getEl().on({click:function(e){"refresh"===e.target.dataset.action&&t.addToQueue()}})},init:function(e){var t,i=e.getViewModel();i.get("entry")&&(t=i.get("entry.type"),"TIME_GRAPH"!==t&&"TIME_GRAPH_DYNAMIC"!==t||e.add({xtype:"timechart",reference:"chart",height:250}),"PIE_GRAPH"===t&&e.add({xtype:"piechart",reference:"chart",height:250}),"EVENT_LIST"===t&&e.add({xtype:"component",html:"Not Implemented",height:250}))},onAfterRender:function(e){setTimeout(function(){e.removeCls("adding")},100),e.getViewModel().bind("{widget.enabled}",function(t){t&&Ext.isFunction(e.fetchData)&&Ung.view.dashboard.Queue.add(e)}),e.getViewModel().notify()},onAfterData:function(){var e=this.getView();Ung.view.dashboard.Queue.next(),e.refreshIntervalSec&&e.refreshIntervalSec>0&&(e.refreshTimeoutId=setTimeout(function(){Ung.view.dashboard.Queue.add(e)},1e3*e.refreshIntervalSec))},onBeforeRemove:function(e){Ung.view.dashboard.Queue.remove(e)},onShow:function(e){console.log("onShow"),e.removeCls("adding")},addToQueue:function(){console.log("fetch data");var e=this.getView();e.refreshTimeoutId&&clearTimeout(e.refreshTimeoutId),Ung.view.dashboard.Queue.addFirst(e)},resizeWidget:function(){var e=this.getView();e.hasCls("small")?e.removeCls("small").addCls("medium"):e.hasCls("medium")?e.removeCls("medium").addCls("large"):e.hasCls("large")?e.removeCls("large").addCls("x-large"):e.hasCls("x-large")&&e.removeCls("x-large").addCls("small"),e.updateLayout()}}),Ext.define("Ung.widget.Information",{extend:"Ext.container.Container",alias:"widget.informationwidget",controller:"widget",hidden:!0,border:!1,baseCls:"widget small info-widget adding",bind:{hidden:"{!widget.enabled}"},layout:{type:"vbox",align:"stretch"},items:[{xtype:"component",cls:"header",html:"<h1>"+"Information".t()+"</h1>"},{xtype:"component",cls:"info-host",padding:5,bind:{html:'<p class="hostname">{stats.hostname}</p><p class="version">{stats.version}</p>'}},{xtype:"component",margin:"10 0",bind:{html:'<span class="info-lbl">'+"uptime".t()+':</span><span class="info-val">{stats.uptimeFormatted}</span><br/><span class="info-lbl">'+"Server".t()+':</span><span class="info-val">{stats.appliance}</span><br/><span class="info-lbl">'+"CPU Count".t()+':</span><span class="info-val">{stats.numCpus}</span><br/><span class="info-lbl">'+"CPU Type".t()+':</span><span class="info-val">{stats.cpuModel}</span><br/><span class="info-lbl">'+"Architecture".t()+':</span><span class="info-val">{stats.architecture}</span><br/><span class="info-lbl">'+"Memory".t()+':</span><span class="info-val">{stats.totalMemory}</span><br/><span class="info-lbl">'+"Disk".t()+':</span><span class="info-val">{stats.totalDisk}</span>'}}]}),Ext.define("Ung.widget.Resources",{extend:"Ext.container.Container",alias:"widget.resourceswidget",controller:"widget",hidden:!0,border:!1,baseCls:"widget",cls:"small adding",bind:{hidden:"{!widget.enabled}"},layout:{type:"vbox",align:"stretch"},items:[{xtype:"component",cls:"header",html:"<h1>"+"Resources".t()+"</h1>"},{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"component",flex:1,padding:"5 10",bind:{html:'<div><p style="margin: 2px; text-align: left; font-weight: bold; font-size: 14px;">'+"Memory".t()+'</p><div class="load-bar"><div class="load-bar-inner" style="left: -{stats.freeMemoryPercent}%;"></div><p>{stats.totalMemory}</p></div><div class="load-bar-values"><div class="load-used"><strong>{stats.usedMemoryPercent}%</strong> used<br/><span>{stats.usedMemory}</span></div><div class="load-free">free <strong>{stats.freeMemoryPercent}%</strong><br/><span>{stats.freeMemory}</span></div></div></div>'}},{xtype:"component",flex:1,padding:"5 10",bind:{html:'<div><p style="margin: 2px; text-align: left; font-weight: bold; font-size: 14px;">'+"Swap".t()+'</p><div class="load-bar"><div class="load-bar-inner" style="left: -{stats.freeSwapPercent}%;"></div><p>{stats.totalSwap}</p></div><div class="load-bar-values"><div class="load-used"><strong>{stats.usedSwapPercent}%</strong> used<br/><span>{stats.usedSwap}</span></div><div class="load-free">free <strong>{stats.freeSwapPercent}%</strong><br/><span>{stats.freeSwap}</span></div></div></div>'}},{xtype:"component",flex:1,padding:"5 10",bind:{html:'<div><p style="margin: 2px; text-align: left; font-weight: bold; font-size: 14px;">'+"Disk".t()+'</p><div class="load-bar"><div class="load-bar-inner" style="left: -{stats.freeDiskPercent}%;"></div><p>{stats.totalDisk}</p></div><div class="load-bar-values"><div class="load-used"><strong>{stats.usedDiskPercent}%</strong> used<br/><span>{stats.usedDisk}</span></div><div class="load-free">free <strong>{stats.freeDiskPercent}%</strong><br/><span>{stats.freeDisk}</span></div></div></div>'}}]}]}),Ext.define("Ung.widget.NetworkInformation",{extend:"Ext.container.Container",alias:"widget.networkinformationwidget",controller:"widget",hidden:!0,border:!1,baseCls:"widget small adding",layout:{type:"vbox",align:"stretch"},bind:{hidden:"{!widget.enabled}"},viewModel:!0,refreshIntervalSec:3,items:[{xtype:"component",cls:"header",itemId:"header",html:"<h1>"+"Network Information".t()+'</h1><button class="action-btn"><i class="material-icons" data-action="refresh">refresh</i></button>'},{xtype:"container",items:[{xtype:"component",bind:{html:'<div class="info-box" style="border-bottom: 1px #EEE solid;"><div class="info-item">'+"Currently Active".t()+'<br/><span>{stats.activeHosts}</span></div><div class="info-item">'+"Maximum Active".t()+'<br/><span>{stats.maxActiveHosts}</span></div><div class="info-item">'+"Known Devices".t()+'<br/><span>{stats.knownDevices}</span></div><div class="info-actions"><a class="wg-button" href="#hosts" style="flex: 1;">'+"Hosts".t()+'</a><a class="wg-button" href="#devices" style="flex: 1;">'+"Devices".t()+"</a></div></div>"}},{xtype:"component",bind:{html:'<div class="info-box"><div class="info-item">'+"Total Sessions".t()+'<br/><span>{sessions.totalSessions}</span></div><div class="info-item">'+"Scanned Sessions".t()+'<br/><span>{sessions.scannedSessions}</span></div><div class="info-item">'+"Bypassed Sessions".t()+'<br/><span>{sessions.bypassedSessions}</span></div><div class="info-actions"><a class="wg-button" href="#sessions" style="flex: 1;">'+"Sessions".t()+"</a> </div></div>"}}]}],fetchData:function(){var e=this,t=this.getViewModel();t&&Rpc.asyncData("rpc.sessionMonitor.getSessionStats").then(function(i){t.set("sessions",i),e.fireEvent("afterdata")})}}),Ext.define("Ung.widget.MapDistribution",{extend:"Ext.container.Container",alias:"widget.mapdistributionwidget",controller:"widget",hidden:!0,border:!1,baseCls:"widget",cls:"adding",layout:{type:"vbox",align:"stretch"},bind:{hidden:"{!widget.enabled}"},refreshIntervalSec:5,items:[{xtype:"container",layout:{type:"hbox",align:"top"},cls:"header",style:{height:"50px"},items:[{xtype:"component",flex:1,html:"<h1>"+"Map Distribution".t()+"</h1>"},{xtype:"container",margin:"10 5 0 0",layout:{type:"hbox",align:"middle"},items:[{xtype:"button",baseCls:"action",text:'<i class="material-icons">refresh</i>',listeners:{click:"fetchData"}}]}]},{xtype:"container",html:"Under construction"}],fetchData:function(){var e=this;e.fireEvent("afterdata")}}),Ext.define("Ung.view.apps.AppsController",{extend:"Ext.app.ViewController",alias:"controller.apps",control:{"#":{activate:"getPolicies"},"#installedApps":{activate:"filterInstalled"},"#installableApps":{activate:"filterInstallable",select:"onInstallNode"}},nodeDesc:{"untangle-node-web-filter":"Web Filter scans and categorizes web traffic to monitor and enforce network usage policies.".t(),"untangle-node-web-monitor":"Web monitor scans and categorizes web traffic to monitor and enforce network usage policies.".t(),"untangle-node-virus-blocker":"Virus Blocker detects and blocks malware before it reaches users desktops or mailboxes.".t(),"untangle-node-virus-blocker-lite":"Virus Blocker Lite detects and blocks malware before it reaches users desktops or mailboxes.".t(),"untangle-node-spam-blocker":"Spam Blocker detects, blocks, and quarantines spam before it reaches users mailboxes.".t(),"untangle-node-spam-blocker-lite":"Spam Blocker Lite detects, blocks, and quarantines spam before it reaches users mailboxes.".t(),"untangle-node-phish-blocker":"Phish Blocker detects and blocks phishing emails using signatures.".t(),"untangle-node-web-cache":"Web Cache stores and serves web content from local cache for increased speed and reduced bandwidth usage.".t(),"untangle-node-bandwidth-control":"Bandwidth Control monitors, manages, and shapes bandwidth usage on the network".t(),"untangle-casing-ssl-inspector":"SSL Inspector allows for full decryption of HTTPS and SMTPS so that other applications can process the encrytped streams.".t(),"untangle-node-application-control":"Application Control scans sessions and identifies the associated applications allowing each to be flagged and/or blocked.".t(),"untangle-node-application-control-lite":"Application Control Lite identifies, logs, and blocks sessions based on the session content using custom signatures.".t(),"untangle-node-captive-portal":"Captive Portal allows administrators to require network users to complete a defined process, such as logging in or accepting a network usage policy, before accessing the internet.".t(),
"untangle-node-firewall":"Firewall is a simple application that flags and blocks sessions based on rules.".t(),"untangle-node-ad-blocker":"Ad Blocker blocks advertising content and tracking cookies for scanned web traffic.".t(),"untangle-node-reports":"Reports records network events to provide administrators the visibility and data necessary to investigate network activity.".t(),"untangle-node-policy-manager":"Policy Manager enables administrators to create different policies and handle different sessions with different policies based on rules.".t(),"untangle-node-directory-connector":"Directory Connector allows integration with external directories and services, such as Active Directory, RADIUS, or Google.".t(),"untangle-node-wan-failover":"WAN Failover detects WAN outages and re-routes traffic to any other available WANs to maximize network uptime.".t(),"untangle-node-wan-balancer":"WAN Balancer spreads network traffic across multiple internet connections for better performance.".t(),"untangle-node-ipsec-vpn":"IPsec VPN provides secure network access and tunneling to remote users and sites using IPsec, GRE, L2TP, Xauth, and IKEv2 protocols.".t(),"untangle-node-openvpn":"OpenVPN provides secure network access and tunneling to remote users and sites using the OpenVPN protocol.".t(),"untangle-node-intrusion-prevention":"Intrusion Prevention blocks scans, detects, and blocks attacks and suspicious traffic using signatures.".t(),"untangle-node-configuration-backup":"Configuration Backup automatically creates backups of settings uploads them to My Account and Google Drive.".t(),"untangle-node-branding-manager":"The Branding Settings are used to set the logo and contact information that will be seen by users (e.g. reports).".t(),"untangle-node-live-support":"Live Support provides on-demand help for any technical issues.".t()},refs:{installedApps:"#installedApps",installableApps:"#installableApps"},getPolicies:function(){console.log("on activate");var e=this,t=this.getViewModel();Rpc.asyncData("rpc.nodeManager.getAppsViews").then(function(i){console.log(i);var n=[];t.getStore("apps").removeAll(),Ext.Array.each(i[0].nodeProperties.list,function(e){n.push({name:e.name,displayName:e.displayName,type:e.type,viewPosition:e.viewPosition,status:null,targetState:i[0].instances.list.filter(function(t){return e.name===t.nodeName})[0].targetState})}),Ext.Array.each(i[0].installable.list,function(t){n.push({name:t.name,displayName:t.displayName,type:t.type,viewPosition:t.viewPosition,desc:e.nodeDesc[t.name],status:"available"})}),t.getStore("apps").loadData(n)})},filterInstalled:function(){this.getViewModel().set("onInstalledApps",!0),console.log("filter installed");var e=this.getViewModel().getStore("apps");e.clearFilter(),e.filterBy(function(e){return!e.get("status")||"installing"===e.get("status")||"installed"===e.get("status")})},filterInstallable:function(){this.getViewModel().set("onInstalledApps",!1);var e=this.getViewModel().getStore("apps");e.each(function(e){"installed"===e.get("status")&&e.set("status",null)}),e.clearFilter(),e.filterBy(function(e){return Ext.Array.contains(["available","installing","installed"],e.get("status"))})},setPolicy:function(e,t,i){null!==i&&(this.redirectTo("#apps/"+t,!1),this.updateNodes())},onInstallNode:function(e,t){t.set("status","installing"),Rpc.asyncData("rpc.nodeManager.instantiate",t.get("name"),1).then(function(e){t.set("status","installed")})}}),Ext.define("Ung.view.apps.Apps",{extend:"Ext.panel.Panel",xtype:"ung.apps",itemId:"apps",layout:"card",requires:["Ung.view.apps.AppsController"],controller:"apps",viewModel:{data:{onInstalledApps:!1},stores:{apps:{fields:["name","displayName","type","status"],sorters:[{property:"viewPosition",direction:"ASC"}]}}},config:{policy:void 0},defaults:{border:!1},dockedItems:[{xtype:"toolbar",dock:"top",border:!1,items:[{xtype:"combobox",editable:!1,multiSelect:!1,queryMode:"local",hidden:!0,bind:{value:"{policyId}",store:"{policies}",hidden:"{!onInstalledApps}"},valueField:"policyId",displayField:"displayName",listeners:{change:"setPolicy"}},{xtype:"button",html:"Install Apps".t(),iconCls:"fa fa-download",hrefTarget:"_self",hidden:!0,bind:{href:"#apps/{policyId}/install",hidden:"{!onInstalledApps}"}},{xtype:"button",html:"Back to Apps".t(),iconCls:"fa fa-arrow-circle-left",hrefTarget:"_self",hidden:!0,bind:{href:"#apps/{policyId}",hidden:"{onInstalledApps}"}}]}],items:[{xtype:"dataview",scrollable:!0,itemId:"installedApps",bind:"{apps}",tpl:'<p class="apps-title">'+"Apps".t()+'</p><tpl for="."><tpl if="type === \'FILTER\'"><a href="#config" class="app-item"><span class="state {targetState}"><i class="fa fa-power-off"></i></span><img src="'+resourcesBaseHref+'/skins/modern-rack/images/admin/apps/{name}_80x80.png" width=80 height=80/><span class="app-name">{displayName}</span></a></tpl></tpl><p class="apps-title">'+"Service Apps".t()+'</p><tpl for="."><tpl if="type === \'SERVICE\'"><a href="#config" class="app-item"><span class="state {targetState}"><i class="fa fa-power-off"></i></span><img src="'+resourcesBaseHref+'/skins/modern-rack/images/admin/apps/{name}_80x80.png" width=80 height=80/><span class="app-name">{displayName}</span></a></tpl></tpl>',itemSelector:"a"},{xtype:"dataview",scrollable:!0,itemId:"installableApps",bind:{store:"{apps}"},tpl:'<p class="apps-title">'+"Apps".t()+'</p><tpl for="."><tpl if="type === \'FILTER\'"><div class="node-install-item {status}"><img src="'+resourcesBaseHref+'/skins/modern-rack/images/admin/apps/{name}_80x80.png" width=80 height=80/><i class="fa fa-download fa-3x"></i><i class="fa fa-check fa-3x"></i><span class="loader">Loading...</span><h3>{displayName}</h3><p>{desc}</p></div></tpl></tpl><p class="apps-title">'+"Service Apps".t()+'</p><tpl for="."><tpl if="type === \'SERVICE\'"><div class="node-install-item {status}"><img src="'+resourcesBaseHref+'/skins/modern-rack/images/admin/apps/{name}_80x80.png" width=80 height=80/><i class="fa fa-download fa-3x"></i><i class="fa fa-check fa-3x"></i><span class="loader">Loading...</span><h3>{displayName}</h3><p>{desc}</p></div></tpl></tpl>',itemSelector:"div"}]}),Ext.define("Ung.view.config.ConfigController",{extend:"Ext.app.ViewController",alias:"controller.config",control:{"#":{deactivate:"onDeactivate"},"#subNav":{selectionchange:"onSelect"}},listen:{global:{loadconfig:"onLoadConfig"}},onSelect:function(e,t){t.selected=!0},onLoadConfig:function(e,t){var i=this.getView();if(!e)return void i.setActiveItem(1);i.down("#configCard")&&i.down("#configCard").destroy();var n=e.charAt(0).toUpperCase()+e.slice(1).toLowerCase();console.log(n),i.down("#subNav").getStore().each(function(t){t.get("url")===e?t.set("selected","x-item-selected"):t.set("selected","")}),i.setLoading("Loading "+n.t()+"..."),console.log(n),Ext.require("Ung.view.config."+n.toLowerCase()+"."+n,function(){i.down("#configWrapper").add({xtype:"ung.config."+n.toLowerCase(),region:"center",itemId:"configCard"}),i.setLoading(!1),i.setActiveItem(2),console.log(t),t&&i.down("#configCard").setActiveItem(t)})},onDeactivate:function(e){console.log("here")}}),Ext.define("Ung.cmp.EditorFields",{singleton:!0,alternateClassName:"Fields",conditions:{flex:1,dataIndex:"conditions",renderer:"conditionsRenderer"},enableRule:function(e){return{xtype:"checkbox",fieldLabel:e||"Enable".t(),bind:"{record.enabled}"}},enableIpv6:{xtype:"checkbox",fieldLabel:"Enable IPv6 Support".t(),bind:"{record.ipv6Enabled}"},blocked:{xtype:"combo",fieldLabel:"Action".t(),bind:"{record.blocked}",store:[[!0,"Block".t()],[!1,"Pass".t()]],queryMode:"local",editable:!1},allow:{xtype:"combo",fieldLabel:"Action".t(),bind:"{record.allow}",store:[[!1,"Deny".t()],[!0,"Allow".t()]],queryMode:"local",editable:!1},bypass:{xtype:"combo",fieldLabel:"Action".t(),bind:"{record.bypass}",store:[[!0,"Bypass".t()],[!1,"Process".t()]],queryMode:"local",editable:!1},macAddress:{xtype:"textfield",fieldLabel:"MAC Address".t(),allowBlank:!1,bind:"{record.macAddress}",emptyText:"[enter MAC name]".t(),vtype:"macAddress",maskRe:/[a-fA-F0-9:]/},ipAddress:{xtype:"textfield",fieldLabel:"Address".t(),emptyText:"[enter address]".t(),bind:"{record.address}",allowBlank:!1,vtype:"ipAddress"},network:{xtype:"textfield",fieldLabel:"Network".t(),emptyText:"1.2.3.0".t(),allowBlank:!1,vtype:"ipAddress",bind:"{record.network}"},netMask:{xtype:"combo",fieldLabel:"Netmask/Prefix".t(),bind:"{record.prefix}",store:Util.getV4NetmaskList(!1),queryMode:"local",editable:!1},natType:{xtype:"combo",fieldLabel:"NAT Type".t(),bind:"{record.auto}",allowBlank:!1,editable:!1,store:[[!0,"Auto".t()],[!1,"Custom".t()]],queryMode:"local"},natSource:{xtype:"textfield",fieldLabel:"New Source".t(),width:100,bind:{value:"{record.newSource}",disabled:"{record.auto}"},allowBlank:!0,vtype:"ipAddress"},description:{xtype:"textfield",fieldLabel:"Description".t(),bind:"{record.description}",emptyText:"[no description]".t(),allowBlank:!1},newDestination:{xtype:"textfield",fieldLabel:"New Destination".t(),bind:"{record.newDestination}",allowBlank:!1,vtype:"ipAddress"},newPort:{xtype:"numberfield",fieldLabel:"New Port".t(),width:100,bind:"{record.newPort}",allowBlank:!0,minValue:1,maxValue:65535,vtype:"port"},priority:{xtype:"combo",fieldLabel:"Priority".t(),store:[[1,"Very High".t()],[2,"High".t()],[3,"Medium".t()],[4,"Low".t()],[5,"Limited".t()],[6,"Limited More".t()],[7,"Limited Severely".t()]],bind:"{record.priority}",queryMode:"local",editable:!1}}),Ext.define("Ung.overrides.form.field.Date",{override:"Ext.form.field.Date",config:{format:""}}),Ext.define("Ung.view.config.Config",{extend:"Ext.container.Container",xtype:"ung.config",itemId:"config",requires:["Ung.view.config.ConfigController","Ung.cmp.EditorFields","Ung.cmp.Conditions","Ung.overrides.form.field.Date"],controller:"config",items:[{xtype:"dataview",store:{data:[{name:"Network".t(),url:"network",icon:"icon_config_network.png"},{name:"Administration".t(),url:"administration",icon:"icon_config_admin.png"},{name:"Email".t(),url:"email",icon:"icon_config_email.png"},{name:"Local Directory".t(),url:"localdirectory",icon:"icon_config_directory.png"},{name:"Upgrade".t(),url:"upgrade",icon:"icon_config_upgrade.png"},{name:"System".t(),url:"system",icon:"icon_config_system.png"},{name:"About".t(),url:"about",icon:"icon_config_about.png"}]},tpl:'<p class="apps-title">'+"Configuration".t()+'</p><tpl for="."><a href="#config/{url}" class="app-item"><img src="'+resourcesBaseHref+'/skins/modern-rack/images/admin/config/{icon}" width=80 height=80/><span class="app-name">{name}</span></a></tpl>',itemSelector:"a"},{xtype:"dataview",store:{data:[{name:"Sessions".t(),url:"sessions",icon:"icon_config_sessions.png"},{name:"Hosts".t(),url:"hosts",icon:"icon_config_hosts.png"},{name:"Devices".t(),url:"devices",icon:"icon_config_devices.png"}]},tpl:'<p class="apps-title">'+"Tools".t()+'</p><tpl for="."><a href="#{url}" class="app-item"><img src="'+resourcesBaseHref+'/skins/modern-rack/images/admin/config/{icon}" width=80 height=80/><span class="app-name">{name}</span></a></tpl>',itemSelector:"a"}]}),Ext.define("Ung.view.reports.ReportsController",{extend:"Ext.app.ViewController",alias:"controller.reports",init:function(){this.getAvailableTables()},control:{"#":{activate:"onBeforeActivate",beforedeactivate:"onBeforeDeactivate"},"#categoriesGrid":{selectionchange:"onCategorySelect"},"#reportsGrid":{selectionchange:"onReportSelect"},"#chart":{afterrender:"fetchReportData"},"#startDate":{select:"onSelectStartDate"},"#startTime":{select:"onSelectStartTime"},"#startDateTimeBtn":{click:"setStartDateTime"},"#endDate":{select:"onSelectEndDate"},"#endTime":{select:"onSelectEndTime"},"#endtDateTimeBtn":{click:"setEndDateTime"},"#refreshBtn":{click:"fetchReportData"},"#applyBtn":{click:"fetchReportData"},"#chartStyleBtn":{toggle:"fetchReportData"},"#timeIntervalBtn":{toggle:"fetchReportData"},"#saveNewBtn":{click:"saveReport"},"#updateBtn":{click:"updateReport"},"#removeBtn":{click:"removeReport"},"#dashboardBtn":{click:"toggleDashboardWidget"}},listen:{global:{init:"getCurrentApplications"},store:{"#categories":{datachanged:"onCategoriesLoad"}}},onCategoriesLoad:function(){var e=this.getViewModel();if(e.get("category")){var t=Ext.getStore("categories").findRecord("categoryName",e.get("category"));this.getView().down("#categoriesGrid").getSelectionModel().select(t)}},onBeforeActivate:function(){var e=this.getViewModel();if(this.getView().getInitCategory())return e.set({isNodeReporting:!0,activeCard:"categoryCard",category:null,report:null,categoriesData:null,startDateTime:null,endDateTime:null}),this.getView().down("#categoriesGrid").setCollapsed(!1),Ext.getStore("reports").filter({property:"category",value:this.getView().getInitCategory().categoryName,exactMatch:!0}),void this.buildReportsList();e.set({isNodeReporting:!1,activeCard:"allCategoriesCard",report:null,categoriesData:null,startDateTime:null,endDateTime:null});var t=this;e.bind("{category}",function(e){if(e){var i=Ext.getStore("categories").findRecord("categoryName",e);t.getView().down("#categoriesGrid").getSelectionModel().select(i)}else t.onBeforeDeactivate()})},onBeforeDeactivate:function(){this.getView().down("#categoriesGrid").getSelectionModel().deselectAll(),this.getView().down("#reportsGrid").getSelectionModel().deselectAll(),this.getViewModel().set("activeCard","allCategoriesCard"),Ext.getStore("reports").clearFilter()},getCurrentApplications:function(){var e,t,i=(this.getViewModel(),[{categoryName:"Hosts",type:"system",url:"hosts",displayName:"Hosts".t(),icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_hosts.png"},{categoryName:"Devices",type:"system",url:"devices",displayName:"Devices".t(),icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_devices.png"},{categoryName:"Network",type:"system",url:"network",displayName:"Network".t(),icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_network.png"},{categoryName:"Administration",type:"system",url:"administration",displayName:"Administration".t(),icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_admin.png"},{categoryName:"System",type:"system",url:"system",displayName:"System".t(),icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_system.png"},{categoryName:"Shield",type:"system",url:"shield",displayName:"Shield".t(),icon:resourcesBaseHref+"/skins/modern-rack/images/admin/apps/untangle-node-shield_17x17.png"}]);Rpc.asyncData("rpc.reportsManager.getCurrentApplications").then(function(n){for(t=0;t<n.list.length;t+=1)e=n.list[t],"untangle-node-branding-manager"!==e.name&&"untangle-node-live-support"!==e.name&&i.push({categoryName:e.displayName,type:"app",url:e.name.replace("untangle-node-",""),displayName:e.displayName,icon:resourcesBaseHref+"/skins/modern-rack/images/admin/apps/"+e.name+"_80x80.png"});Ext.getStore("categories").loadData(i)})},getAvailableTables:function(){var e=this;rpc.reportsManager&&Rpc.asyncData("rpc.reportsManager.getTables").then(function(t){e.getViewModel().set("tableNames",t)})},onCategorySelect:function(e,t){return console.log("here"),0!==t.length&&(this.getViewModel().set("activeCard","categoryCard"),this.getViewModel().set("category",t[0]),this.getViewModel().set("report",null),this.getView().down("#categoriesGrid").setCollapsed(!1),this.getView().down("#reportsGrid").getSelectionModel().deselectAll(),Ung.app.redirectTo("#reports/"+t[0].get("url")),console.log(t[0].get("categoryName")),Ext.getStore("reports").filter({property:"category",value:t[0].get("categoryName"),exactMatch:!0}),void this.buildReportsList())},buildReportsList:function(){var e=this,t=[],i="";this.getView().down("#categoryReportsList").removeAll(),Ext.getStore("reports").getRange().forEach(function(n){i='<i class="fa '+n.get("icon")+' fa-lg"></i><span class="ttl">'+(n.get("readOnly")?n.get("title").t():n.get("title"))+"</span><p>"+(n.get("readOnly")?n.get("description").t():n.get("description"))+"</p>",t.push({xtype:"button",html:i,baseCls:"entry-btn",border:!1,textAlign:"left",item:n,handler:function(){e.getView().down("#reportsGrid").getSelectionModel().select(this.item)}})}),this.getView().down("#categoryReportsList").add(t)},onReportSelect:function(e,t){if(0===t.length)return void this.getViewModel().set({activeCard:"categoryCard"});var i=t[0],n=this.getView().down("#report");this.getViewModel().set({activeCard:"reportCard",report:i}),this.getView().down("#customization").setActiveItem(0),n.remove("chart"),"TIME_GRAPH"!==i.get("type")&&"TIME_GRAPH_DYNAMIC"!==i.get("type")||n.add({xtype:"timechart",itemId:"chart",entry:i}),"PIE_GRAPH"===i.get("type")&&n.add({xtype:"piechart",itemId:"chart",entry:i}),"EVENT_LIST"===i.get("type")&&n.add({xtype:"eventchart",itemId:"chart",entry:i}),"TEXT"===i.get("type")&&n.add({xtype:"component",itemId:"chart",html:"Not Implemented"})},fetchReportData:function(){var e=this,t=e.getViewModel(),i=e.getView().down("#chart");if(i.fireEvent("beginfetchdata"),"EVENT_LIST"!==t.get("report.type"))Rpc.asyncData("rpc.reportsManager.getDataForReportEntry",i.getEntry().getData(),t.get("startDateTime"),t.get("endDateTime"),-1).then(function(e){i.fireEvent("setseries",e.list)});else{var n=null,a=100;Rpc.asyncData("rpc.reportsManager.getEventsForDateRangeResultSet",i.getEntry().getData(),n,a,t.get("startDateTime"),t.get("endDateTime")).then(function(e){e.getNextChunk(function(e,t){return t?(Util.exceptionToast(t),!1):void i.fireEvent("setdata",e.list)},100)})}},onSelectStartDate:function(e,t){var i,n=this.getViewModel();n.get("startDateTime")?(i=new Date(n.get("startDateTime")),i.setDate(t.getDate()),i.setMonth(t.getMonth()),n.set("startDateTime",i)):this.getViewModel().set("startDateTime",t)},onSelectStartTime:function(e,t){var i,n=this.getViewModel();i=n.get("startDateTime")?new Date(n.get("startDateTime")):new Date,i.setHours(t.get("date").getHours()),i.setMinutes(t.get("date").getMinutes()),n.set("startDateTime",i)},setStartDateTime:function(){var e=this.getView();console.log(this.getViewModel().get("startDateTime")),e.down("#startDateTimeMenu").hide()},onSelectEndDate:function(e,t){var i,n=this.getViewModel();n.get("endDateTime")?(i=new Date(n.get("endDateTime")),i.setDate(t.getDate()),i.setMonth(t.getMonth()),n.set("endDateTime",i)):this.getViewModel().set("endDateTime",t)},onSelectEndTime:function(e,t){var i,n=this.getViewModel();i=n.get("endDateTime")?new Date(n.get("endDateTime")):new Date,i.setHours(t.get("date").getHours()),i.setMinutes(t.get("date").getMinutes()),n.set("endDateTime",i)},setEndDateTime:function(){var e=this.getView();e.down("#endDateTimeMenu").hide()},saveReport:function(){var e,t=this,i=this.getViewModel();e=i.get("report").copy(null),e.set("uniqueId","report-"+Math.random().toString(36).substr(2)),e.set("readOnly",!1),Rpc.asyncData("rpc.reportsManager.saveReportEntry",e.getData()).then(function(n){i.get("report").reject(),Ext.getStore("reports").add(e),e.commit(),t.getView().down("#reportsGrid").getSelectionModel().select(e),Util.successToast('<span style="color: yellow; font-weight: 600;">'+e.get("title")+" report added!")})},updateReport:function(){var e=this.getViewModel();Rpc.asyncData("rpc.reportsManager.saveReportEntry",e.get("report").getData()).then(function(t){e.get("report").commit(),Util.successToast('<span style="color: yellow; font-weight: 600;">'+e.get("report.title")+"</span> report updated!")})},removeReport:function(){var e=this,t=this.getViewModel();Ext.MessageBox.confirm("Warning".t(),"This will remove also the Widget from Dashboard".t()+"<br/><br/>"+"Do you want to continue?".t(),function(i){"yes"===i&&Rpc.asyncData("rpc.reportsManager.removeReportEntry",t.get("report").getData()).then(function(i){Ext.getStore("reports").remove(t.get("report")),e.buildReportsList(),e.getView().down("#reportsGrid").getSelectionModel().deselectAll(),Util.successToast("Report removed!"),e.toggleDashboardWidget()})})},toggleDashboardWidget:function(){var e,t=this.getViewModel(),i=this;t.get("isWidget")?(e=Ext.getStore("widgets").findRecord("entryId",t.get("report.uniqueId")),e?(Ext.getStore("widgets").remove(e),Ung.dashboardSettings.widgets.list=Ext.Array.pluck(Ext.getStore("widgets").getRange(),"data"),Rpc.asyncData("rpc.dashboardManager.setSettings",Ung.dashboardSettings).then(function(e){Util.successToast('<span style="color: yellow; font-weight: 600;">'+t.get("report.title")+"</span> was removed from dashboard!"),Ext.GlobalEvents.fireEvent("removewidget",t.get("report.uniqueId")),t.set("isWidget",!t.get("isWidget")),i.getView().down("#reportsGrid").getView().refresh()})):Util.exceptionToast('<span style="color: yellow; font-weight: 600;">'+t.get("report.title")+"</span> was not found on Dashboard!")):(e=Ext.create("Ung.model.Widget",{displayColumns:t.get("report.displayColumns"),enabled:!0,entryId:t.get("report.uniqueId"),javaClass:"com.untangle.uvm.DashboardWidgetSettings",refreshIntervalSec:60,timeframe:3600,type:"ReportEntry"}),Ext.getStore("widgets").add(e),Ung.dashboardSettings.widgets.list=Ext.Array.pluck(Ext.getStore("widgets").getRange(),"data"),Rpc.asyncData("rpc.dashboardManager.setSettings",Ung.dashboardSettings).then(function(n,a){return a?void Util.exceptionToast(a):(Util.successToast('<span style="color: yellow; font-weight: 600;">'+t.get("report.title")+"</span> was added to dashboard!"),Ext.GlobalEvents.fireEvent("addwidget",e,t.get("report")),t.set("isWidget",!t.get("isWidget")),void i.getView().down("#reportsGrid").getView().refresh())}))}}),Ext.define("Ung.view.reports.ReportsModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.reports",data:{isNodeReporting:!1,activeCard:"allCategoriesCard",category:null,report:null,categoriesData:null,startDateTime:null,endDateTime:null},formulas:{isCategorySelected:function(e){return"allCategoriesCard"!==e("activeCard")},areCategoriesHidden:function(e){return!e("isCategorySelected")||e("isNodeReporting")},reportHeading:function(e){return e("report.readOnly")?"<h2>"+e("report.title").t()+"</h2><p>"+e("report.description").t()+"</p>":"<h2>"+e("report.title")+"</h2><p>"+e("report.description")+"</p>"},isTimeGraph:function(e){return!!e("report.type")&&e("report.type").indexOf("TIME_GRAPH")>=0},isPieGraph:function(e){return!!e("report.type")&&e("report.type").indexOf("PIE_GRAPH")>=0},startDate:function(e){return e("startDateTime")?Ext.Date.format(e("startDateTime"),"M j, h:i a"):"One day ago".t()},endDate:function(e){return e("endDateTime")?Ext.Date.format(e("endDateTime"),"M j, h:i a"):"Present".t()},startTimeMax:function(e){var t=new Date,i=new Date(e("startDateTime"));if(t.getYear()===i.getYear()&&t.getMonth()===i.getMonth()&&t.getDate()===i.getDate())return t},customizeTitle:function(e){return e("report.readOnly")?"Customize".t()+' <span style="font-weight: 300; color: #777;">(Readonly report! Changes can be saved as a new custom report!)</span>':"Customize".t()},isWidget:function(e){return!!Ext.getStore("widgets").findRecord("entryId",e("report.uniqueId"))}},stores:{categories:{model:"Ung.model.Category",data:"{categoriesData}"}}}),Ext.define("Ung.model.Category",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"displayName",type:"string"},{name:"icon",type:"string"}],proxy:{type:"memory",reader:{type:"json"}}}),Ext.define("Ung.view.reports.Reports",{extend:"Ext.container.Container",xtype:"ung.reports",itemId:"reports",layout:"border",requires:["Ung.view.reports.ReportsController","Ung.view.reports.ReportsModel","Ung.model.Category"],controller:"reports",viewModel:{type:"reports"},config:{initCategory:null},items:[{region:"west",xtype:"grid",itemId:"categoriesGrid",title:"Select Category".t(),width:200,hideHeaders:!0,shadow:!1,collapsible:!0,floatable:!1,titleCollapse:!0,animCollapse:!1,viewConfig:{stripeRows:!1},hidden:!0,store:"categories",bind:{hidden:"{areCategoriesHidden}"},columns:[{dataIndex:"icon",width:20,renderer:function(e,t){return t.tdCls="app-icon",'<img src="'+e+'"/>'}},{dataIndex:"displayName",flex:1}]},{region:"center",layout:"border",border:!1,items:[{region:"west",xtype:"grid",itemId:"reportsGrid",title:"Select Report".t(),width:250,hideHeaders:!0,shadow:!1,collapsible:!0,layout:"fit",animCollapse:!1,floatable:!1,titleCollapse:!0,viewConfig:{stripeRows:!1},bind:{hidden:"{!isCategorySelected}",store:"{reports}"},columns:[{dataIndex:"title",width:25,renderer:function(e,t,i){return'<i class="fa '+i.get("icon")+' fa-lg"></i>'}},{dataIndex:"title",flex:1,renderer:function(e,t,i){return i.get("readOnly")?e.t():e}},{dataIndex:"readOnly",width:20,align:"center",renderer:function(e,t){return t.tdCls="app-icon",e?"":'<i class="material-icons" style="font-size: 14px; color: #999;">brush</i>'}},{dataIndex:"uniqueId",width:20,align:"center",renderer:function(e,t){return t.tdCls="app-icon",Ext.getStore("widgets").findRecord("entryId",e)?'<i class="fa fa-home fa-lg" style="font-size: 14px; color: #999;"></i>':""}}]},{region:"center",border:!1,layout:"card",bind:{activeItem:"{activeCard}"},defaults:{border:!1},items:[{xtype:"dataview",itemId:"allCategoriesCard",store:"categories",tpl:'<p class="apps-title">'+"System".t()+'</p><tpl for="."><tpl if="type === \'system\'"><a href="#reports/{url}" class="app-item"><img src="{icon}" width=80 height=80/><span class="app-name">{displayName}</span></a></tpl></tpl><p class="apps-title">'+"Apps".t()+'</p><tpl for="."><tpl if="type === \'app\'"><a href="#reports/{url}" class="app-item"><img src="{icon}" width=80 height=80/><span class="app-name">{displayName}</span></a></tpl></tpl>',itemSelector:"a"},{itemId:"categoryCard",scrollable:!0,items:[{xtype:"component",cls:"headline",margin:"50 0",bind:{html:'<img src="{category.icon}" style="width: 80px; height: 80px;"/><br/>{category.displayName}'}},{xtype:"container",style:{textAlign:"center"},itemId:"categoryReportsList"}]},{layout:"border",itemId:"reportCard",defaults:{border:!1,bodyBorder:!1},items:[{region:"north",height:60,items:[{xtype:"component",cls:"report-header",bind:{html:"{reportHeading}"}}]},{region:"center",itemId:"report",layout:"fit",items:[],bbar:[{xtype:"component",margin:"0 5 0 5",html:'<i class="fa fa-calendar fa-lg"></i>'},{xtype:"button",bind:{text:"{startDate}"},menu:{itemId:"startDateTimeMenu",plain:!0,showSeparator:!1,shadow:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"datepicker",maxDate:new Date,itemId:"startDate"},{xtype:"timefield",itemId:"startTime",format:"h:i a",increment:30,margin:"5",fieldLabel:"Time".t(),labelAlign:"right",labelWidth:60,width:160,plain:!0,editable:!1,value:"12:00 am",bind:{maxValue:"{startTimeMax}"}},{xtype:"button",itemId:"startDateTimeBtn",text:"OK".t(),iconCls:"fa fa-check fa-lg"}]}},{xtype:"button",bind:{text:"{endDate}"},menu:{itemId:"endDateTimeMenu",plain:!0,showSeparator:!1,shadow:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"datepicker",maxDate:new Date,itemId:"endDate",bind:{minDate:"{startDateTime}"}},{xtype:"timefield",itemId:"endTime",format:"h:i a",increment:30,margin:"5",fieldLabel:"Time".t(),labelAlign:"right",labelWidth:60,width:160,plain:!0,editable:!1,value:"12:00 am",bind:{maxValue:"{endTimeMax}"}},{xtype:"button",itemId:"endDateTimeBtn",text:"OK".t(),iconCls:"fa fa-check fa-lg"}]}},"-",{text:"Refresh".t(),iconCls:"fa fa-refresh fa-lg",itemId:"refreshBtn"},"->",{itemId:"downloadBtn",text:"Download".t(),iconCls:"fa fa-download fa-lg"},"-",{itemId:"dashboardBtn",iconCls:"fa fa-home fa-lg",bind:{text:'{isWidget ? "Remove from Dashboard" : "Add to Dashboard"}'}}]},{region:"south",xtype:"form",layout:"fit",minHeight:300,shadow:!1,split:!0,collapsible:!0,collapsed:!1,floatable:!1,titleCollapse:!0,animCollapse:!1,border:!1,bodyBorder:!1,bind:{title:"{customizeTitle}"},items:[{xtype:"tabpanel",itemId:"customization",border:!1,defaults:{border:!1,bodyBorder:!1,bodyPadding:5},items:[{title:"Style".t(),iconCls:"fa fa-eyedropper fa-lg",layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:"Title".t(),maxWidth:400,labelWidth:150,labelAlign:"right",allowBlank:!1,bind:{value:"{report.title}"}},{xtype:"textfield",fieldLabel:"Description".t(),labelWidth:150,labelAlign:"right",bind:{value:"{report.description}"}},{xtype:"container",layout:"hbox",margin:"0 0 5 0",items:[{xtype:"label",cls:"x-form-item-label-default",width:155,style:{textAlign:"right"},text:"Enabled".t()+":"},{xtype:"segmentedbutton",bind:{value:"{report.enabled}"},items:[{text:"YES".t(),iconCls:"fa fa-check fa-lg",value:!0},{text:"NO".t(),iconCls:"fa fa-times fa-lg",value:!1}]}]},{xtype:"container",layout:"hbox",margin:"0 0 5 0",hidden:!0,bind:{disabled:"{!isTimeGraph}",hidden:"{!isTimeGraph}"},items:[{xtype:"label",cls:"x-form-item-label-default",width:155,style:{textAlign:"right"},text:"Time Chart Style".t()+":"},{xtype:"segmentedbutton",itemId:"chartStyleBtn",bind:{value:"{report.timeStyle}"},items:[{text:"Line".t(),value:"LINE",styleType:"spline"},{text:"Area".t(),value:"AREA",styleType:"areaspline"},{text:"Stacked Area".t(),value:"AREA_STACKED",styleType:"areaspline",stacked:!0},{text:"Column".t(),value:"BAR",styleType:"column",grouped:!0},{text:"Overlapped Columns".t(),value:"BAR_OVERLAPPED",styleType:"column",overlapped:!0},{text:"Stacked Columns".t(),value:"BAR_STACKED",styleType:"column",stacked:!0}]}]},{xtype:"container",layout:"hbox",margin:"0 0 5 0",hidden:!0,bind:{disabled:"{!isPieGraph}",hidden:"{!isPieGraph}"},items:[{xtype:"label",cls:"x-form-item-label-default",width:155,style:{textAlign:"right"},text:"Style".t()+":"},{xtype:"segmentedbutton",itemId:"chartStyleBtn",bind:{value:"{report.pieStyle}"},items:[{text:"Pie",value:"PIE",styleType:"pie"},{text:"Donut",value:"DONUT",styleType:"pie"},{text:"Column",value:"COLUMN",styleType:"column"}]}]},{xtype:"container",layout:"hbox",margin:"0 0 5 0",hidden:!0,bind:{disabled:"{!isTimeGraph}",hidden:"{!isTimeGraph}"},items:[{xtype:"label",cls:"x-form-item-label-default",width:155,style:{textAlign:"right"},text:"Time Data Interval".t()+":"},{xtype:"segmentedbutton",itemId:"timeIntervalBtn",bind:{value:"{report.timeDataInterval}"},items:[{text:"Auto".t(),value:"AUTO"},{text:"Second".t(),value:"SECOND",defaultTimeFrame:60},{text:"Minute".t(),value:"MINUTE",defaultTimeFrame:60},{text:"Hour".t(),value:"HOUR",defaultTimeFrame:24},{text:"Day".t(),value:"DAY",defaultTimeFrame:7},{text:"Week".t(),value:"WEEK",defaultTimeFrame:12},{text:"Month".t(),value:"MONTH",defaultTimeFrame:6}]}]},{xtype:"numberfield",fieldLabel:"Pie Slices Number".t(),labelWidth:150,maxWidth:200,labelAlign:"right",minValue:1,maxValue:25,allowBlank:!1,hidden:!0,bind:{disabled:"{!isPieGraph}",hidden:"{!isPieGraph}",value:"{report.pieNumSlices}"}}]},{title:"Conditions".t(),iconCls:"fa fa-filter fa-lg"},{title:"Advanced".t(),iconCls:"fa fa-cog fa-lg",scrollable:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"combobox",fieldLabel:"Table".t(),maxWidth:400,labelWidth:150,labelAlign:"right",editable:!1,hidden:!0,bind:{store:"{tableNames}",disabled:"{!isTimeGraph}",hidden:"{!isTimeGraph}",value:"{report.table}"}},{xtype:"textfield",fieldLabel:"Units".t(),maxWidth:305,labelWidth:150,labelAlign:"right",hidden:!0,bind:{disabled:"{!isTimeGraph}",hidden:"{!isTimeGraph}",value:"{report.units}"}},{xtype:"textarea",fieldLabel:"Time Data Columns".t(),grow:!0,maxWidth:500,labelWidth:150,labelAlign:"right",hidden:!0,bind:{disabled:"{!isTimeGraph}",hidden:"{!isTimeGraph}",value:"{report.timeDataColumns}"}},{xtype:"textfield",fieldLabel:"Series Renderer".t(),maxWidth:305,labelWidth:150,labelAlign:"right",hidden:!0,bind:{disabled:"{!isTimeGraph}",hidden:"{!isTimeGraph}",value:"{report.seriesRenderer}"}},{xtype:"container",layout:"hbox",margin:"0 0 5 0",items:[{xtype:"label",cls:"x-form-item-label-default",width:155,style:{textAlign:"right"},text:"Order By Column".t()+":"},{xtype:"textfield",bind:{value:"{report.orderByColumn}"}},{xtype:"segmentedbutton",margin:"0 0 0 5",bind:{value:"{report.orderDesc}"},items:[{text:"Ascending".t(),iconCls:"fa fa-sort-amount-asc",value:!0},{text:"Descending".t(),iconCls:"fa fa-sort-amount-desc",value:!1}]}]},{xtype:"numberfield",
fieldLabel:"Display Order".t(),maxWidth:220,labelWidth:150,labelAlign:"right",bind:{value:"{report.displayOrder}"}}]}]}],fbar:[{text:"Remove".t(),iconCls:"fa fa-trash fa-lg",itemId:"removeBtn",bind:{hidden:"{report.readOnly}"}},{text:"Update".t(),iconCls:"fa fa-save fa-lg",itemId:"updateBtn",formBind:!0,bind:{hidden:"{report.readOnly}"}},{text:"Save as New Report".t(),iconCls:"fa fa-plus-circle fa-lg",itemId:"saveNewBtn",formBind:!0}]}]}]}]}]}),Ext.define("Ung.cmp.GridController",{extend:"Ext.app.ViewController",alias:"controller.ungrid",addCount:0,control:{"#":{afterrender:"onBeforeRender",drop:"onDropRecord"}},onBeforeRender:function(e){e.conditions&&(e.conditionsMap=Ext.Array.toValueMap(e.conditions,"name"))},addRecord:function(){this.editorWin(null)},addRecordInline:function(){var e=this.getView(),t=Ext.create("Ung.model.Rule",Ext.clone(e.emptyRow));t.set("markedForNew",!0),e.getStore().add(t)},editRecord:function(e,t,i,n,a,o){this.editorWin(o)},editorWin:function(e){this.dialog=this.getView().add({xtype:"ung.cmp.recordeditor",record:e}),this.dialog.show()},deleteRecord:function(e,t,i,n,a,o){o.get("markedForNew")?o.drop():o.set("markedForDelete",!0)},moveUp:function(e,t,i,n,a,o){var r=this.getView().down("grid").getStore();r.remove(o,!0),r.insert(t+n.direction,o)},conditionsRenderer:function(e){var t,i=this.getView(),n=e.list,a=[],o=[];for(t=0;t<n.length;t+=1)o=[],"SRC_INTF"===n[t].conditionType||"DST_INTF"===n[t].conditionType?n[t].value.toString().split(",").forEach(function(e){o.push(Util.interfacesListNamesMap()[e])}):o=n[t].value.toString().split(","),a.push(i.conditionsMap[n[t].conditionType].displayName+"<strong>"+(n[t].invert?" &nrArr; ":" &rArr; ")+'<span class="cond-val '+(n[t].invert?"invert":"")+'">'+o.join(", ")+"</span></strong>");return a.join(" &nbsp;&bull;&nbsp; ")},conditionRenderer:function(e){return this.getView().conditionsMap[e].displayName},onDropRecord:function(){this.getView().getStore().isReordered=!0},importData:function(){Ext.widget("dataimporter",{})},exportData:function(){}}),Ext.define("Ung.cmp.DataImporter",{extend:"Ext.window.Window",width:500,height:200,alias:"widget.dataimporter",title:"Import Settings".t(),viewModel:{data:{importMode:"replace"}},actions:{import:{text:"Import".t(),formBind:!0,iconCls:"fa fa-check",handler:function(e){console.log(e.up("form")),e.up("form").submit({waitMsg:"Please wait while the settings are uploaded...".t(),success:function(){console.log("success")},failure:function(){console.log("failure")}})}},cancel:{text:"Cancel",iconCls:"fa fa-check"}},autoShow:!0,modal:!0,constrain:!0,layout:"fit",bodyStyle:{background:"#FFF"},items:[{xtype:"form",bodyPadding:10,bbar:["->","@cancel","@import"],name:"importSettingsForm",url:"http://localhost:8002/webui/gridSettings",border:!1,items:[{xtype:"radiogroup",columns:1,vertical:!0,simpleValue:!0,bind:"{importMode}",items:[{boxLabel:"Replace current settings".t(),name:"importMode",inputValue:"replace"},{boxLabel:"Prepend to current settings".t(),name:"importMode",inputValue:"prepend"},{boxLabel:"Append to current settings".t(),name:"importMode",inputValue:"append"}]},{xtype:"filefield",width:"100%",fieldLabel:"with settings from".t(),labelAlign:"top",allowBlank:!1,validateOnBlur:!1},{xtype:"hidden",name:"type",value:"import"}]}]}),Ext.define("Ung.model.Condition",{extend:"Ext.data.Model",fields:[{name:"conditionType",type:"string"},{name:"invert",type:"boolean",defaultValue:!1},{name:"javaClass",type:"string"},{name:"value",type:"auto",defaultValue:""}],proxy:{autoLoad:!0,type:"memory",reader:{type:"json"}}}),Ext.define("Ung.widget.ReportModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.reportwidget",formulas:{title:{get:function(e){return"<h1>"+e("entry.title")+(e("entry.timeDataInterval")?' <span style="text-transform: lowercase; color: #777; font-weight: 100;">per '+e("entry.timeDataInterval")+"</span>":"")+"</h1><p>since "+e("timeframe")+" ago</p></h1>"}},timeframe:{get:function(e){return e("widget.timeframe")}}}}),Ext.define("Ung.widget.CpuLoadController",{extend:"Ext.app.ViewController",alias:"controller.cpuload",control:{"#":{afterrender:"onAfterRender",resize:"onResize"}},listen:{store:{"#stats":{datachanged:"addPoint"}}},onAfterRender:function(e){setTimeout(function(){e.removeCls("adding")},100),this.lineChart=new Highcharts.Chart({chart:{type:"areaspline",renderTo:e.lookupReference("cpulinechart").getEl().dom,marginBottom:15,marginTop:20,backgroundColor:"transparent",animation:!1,style:{fontFamily:"Source Sans Pro",fontSize:"12px"}},title:null,credits:{enabled:!1},exporting:{enabled:!1},xAxis:[{type:"datetime",crosshair:{width:1,dashStyle:"ShortDot",color:"rgba(100, 100, 100, 0.3)"},lineColor:"#C0D0E0",lineWidth:1,tickLength:3,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",labels:{style:{fontFamily:"Source Sans Pro",color:"#999",fontSize:"11px",fontWeight:600},y:12},maxPadding:0,minPadding:0}],yAxis:{min:0,minRange:2,lineColor:"#C0D0E0",lineWidth:1,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",tickAmount:4,tickLength:5,tickWidth:1,tickPosition:"inside",opposite:!1,labels:{align:"left",useHTML:!0,padding:0,style:{fontFamily:"Source Sans Pro",color:"#999",fontSize:"11px",fontWeight:600,background:"rgba(255, 255, 255, 0.6)",padding:"0 1px",borderRadius:"2px",lineHeight:"11px"},x:1,y:-2},title:null},legend:{enabled:!1},tooltip:{shared:!0,animation:!0,followPointer:!0,backgroundColor:"rgba(255, 255, 255, 0.7)",borderWidth:1,borderColor:"rgba(0, 0, 0, 0.1)",style:{textAlign:"right",fontFamily:"Source Sans Pro",padding:"5px",fontSize:"10px",marginBottom:"40px"},hideDelay:0,shadow:!1,headerFormat:'<span style="font-size: 11px; line-height: 1.5; font-weight: bold;">{point.key}</span><br/>',pointFormatter:function(){var e="<span>"+this.series.name+"</span>";return e+=': <span style="color: '+this.color+'; font-weight: bold;">'+this.y+"</span>",e+"<br/>"}},plotOptions:{areaspline:{fillOpacity:.15,lineWidth:2},series:{marker:{enabled:!0,radius:0,states:{hover:{enabled:!0,lineWidthPlus:2,radius:4,radiusPlus:2}}},states:{hover:{enabled:!0,lineWidthPlus:0,halo:{size:2}}}}},series:[{name:"load",data:function(){var e,t=[],i=Date.now();try{i=rpc.systemManager.getMilliseconds()}catch(e){console.log("Unable to get current millis.")}for(i=1e3*Math.round(i/1e3),e=-19;e<=0;e+=1)t.push({x:i+3e3*e,y:0});return t}()}]}),this.gaugeChart=new Highcharts.Chart({chart:{type:"gauge",renderTo:e.lookupReference("cpugaugechart").getEl().dom,height:140,margin:[-20,0,0,0],backgroundColor:"transparent",style:{margin:"0 auto"}},credits:{enabled:!1},title:null,exporting:{enabled:!1},pane:[{startAngle:-45,endAngle:45,background:null,center:["50%","135%"],size:280}],tooltip:{enabled:!1},yAxis:[{min:0,max:50,minorTickPosition:"outside",tickPosition:"outside",tickColor:"#555",minorTickColor:"#999",labels:{rotation:"auto",distance:20,step:1},plotBands:[{from:0,to:3,color:"rgba(112, 173, 112, 1)",innerRadius:"100%",outerRadius:"105%"},{from:3,to:6,color:"rgba(255, 255, 0, 1)",innerRadius:"100%",outerRadius:"105%"},{from:6,to:7,color:"rgba(255, 0, 0, 1)",innerRadius:"100%",outerRadius:"105%"}],title:null}],plotOptions:{gauge:{dataLabels:{enabled:!1},dial:{radius:"99%",backgroundColor:"#999"}}},series:[{data:[0]}]}),this.addPoint()},onResize:function(){this.lineChart.reflow(),this.gaugeChart.reflow()},addPoint:function(){if(this.gaugeChart&&this.lineChart){var e=Ext.getStore("stats"),t=this.getViewModel(),i=e.first().getData(),n=i.numCpus+1,a=i.numCpus+4;this.lineChart.yAxis[0].update({minRange:i.numCpus}),this.gaugeChart.yAxis[0].update({max:a+1,plotBands:[{from:0,to:n,color:"rgba(112, 173, 112, 1)",innerRadius:"100%",outerRadius:"105%"},{from:n,to:a,color:"rgba(255, 255, 0, 1)",innerRadius:"100%",outerRadius:"105%"},{from:a,to:a+1,color:"rgba(255, 0, 0, 1)",innerRadius:"100%",outerRadius:"105%"}]}),this.lineChart.series[0].addPoint({x:Date.now(),y:e.first().getData().oneMinuteLoadAvg},!0,!0),this.gaugeChart.series[0].points[0].update(i.oneMinuteLoadAvg<=a+1?i.oneMinuteLoadAvg:a+1,!0),i.oneMinuteLoadAvg<n&&t.set("loadLabel","low".t()),i.oneMinuteLoadAvg>n&&t.set("loadLabel","medium".t()),i.oneMinuteLoadAvg>a&&t.set("loadLabel","high".t())}}}),Ext.define("Ung.widget.CpuLoad",{extend:"Ext.container.Container",alias:"widget.cpuloadwidget",requires:["Ung.widget.CpuLoadController"],controller:"cpuload",viewModel:!0,hidden:!0,border:!1,baseCls:"widget",cls:"small adding",bind:{hidden:"{!widget.enabled}"},layout:{type:"vbox",align:"stretch"},items:[{xtype:"component",cls:"header",html:"<h1>"+"CPU Load".t()+"</h1>"},{xtype:"container",items:[{xtype:"component",height:120,reference:"cpulinechart"},{xtype:"component",reference:"cpugaugechart",height:140},{xtype:"component",cls:"cpu-gauge",bind:{html:"{stats.oneMinuteLoadAvg}<br/><span>{loadLabel}</span>"}}]}]}),Ext.define("Ung.widget.InterfaceItem",{extend:"Ext.Component",alias:"widget.interfaceitem",bind:{html:'<p class="name" style="display: {displayWan};">{iface.name}</p><div class="speeds"><div class="speed_up"><i class="fa fa-caret-down fa-lg"></i> <span>{tx} kB/s</span></div><div class="speed_down"><i class="fa fa-caret-up fa-lg"></i> <span>{rx} kB/s</span></div></div><p class="name" style="display: {displayNotWan};">{iface.name}</p><i class="fa fa-caret-down fa-lg pointer"></i>'},viewModel:{formulas:{displayWan:function(e){return e("iface.isWan")?"block":"none"},displayNotWan:function(e){return e("iface.isWan")?"none":"block"},tx:function(e){var t=e("stats").getData(),i="interface_"+e("iface.interfaceId")+"_txBps";return t.hasOwnProperty(i)?(t[i]/1024).toFixed(2):"-"},rx:function(e){var t=e("stats").getData(),i="interface_"+e("iface.interfaceId")+"_rxBps";return t.hasOwnProperty(i)?(t[i]/1024).toFixed(2):"-"}}}}),Ext.define("Ung.widget.NetworkLayout",{extend:"Ext.container.Container",alias:"widget.networklayoutwidget",requires:["Ung.widget.InterfaceItem"],controller:"widget",hidden:!0,border:!1,baseCls:"widget adding",layout:{type:"vbox",align:"stretch"},bind:{hidden:"{!widget.enabled}"},refreshIntervalSec:0,items:[{xtype:"component",cls:"header",itemId:"header",html:"<h1>"+"Network Layout".t()+'</h1><button class="action-btn"><i class="fa fa-refresh" data-action="refresh"></i></button>'},{cls:"net-layout",margin:10,layout:{type:"vbox",align:"stretch"},border:!1,defaults:{xtype:"component"},items:[{html:'<img src="'+resourcesBaseHref+'/skins/default/images/admin/icons/interface-cloud.png" style="margin: 0 auto; display: block; height: 30px;"/>'},{xtype:"container",cls:"ifaces",height:69,itemId:"externalInterface"},{xtype:"component",cls:"line"},{xtype:"container",cls:"ifaces",height:80,itemId:"internalInterface"},{xtype:"component",cls:"devices",margin:"5 0 0 0",height:40,bind:{html:'<img src="'+resourcesBaseHref+'/skins/default/images/admin/icons/interface-devices.png"><br/>{deviceCount}'}}]}],fetchData:function(){var e=this;Rpc.asyncData("rpc.networkManager.getNetworkSettings").then(function(t){e.fireEvent("afterdata"),e.down("#externalInterface").removeAll(),e.down("#internalInterface").removeAll(),Ext.each(t.interfaces.list,function(t){t.disabled||(t.isWan?e.down("#externalInterface").add({xtype:"interfaceitem",cls:"iface wan",viewModel:{data:{iface:t}}}):e.down("#internalInterface").add({xtype:"interfaceitem",cls:"iface",viewModel:{data:{iface:t}}}))})})}}),Ext.define("Ung.cmp.RecordEditorController",{extend:"Ext.app.ViewController",alias:"controller.recordeditor",control:{"#":{beforerender:"onBeforeRender",afterrender:"onAfterRender"},grid:{afterrender:"onConditionsRender"}},conditionsGrid:{xtype:"grid",trackMouseOver:!1,disableSelection:!0,sortableColumns:!1,enableColumnHide:!1,padding:"10 0",tbar:["@addCondition"],bind:{store:{model:"Ung.model.Condition",data:"{record.conditions.list}"}},viewConfig:{emptyText:'<p style="text-align: center; margin: 0; line-height: 2"><i class="fa fa-exclamation-triangle fa-2x"></i> <br/>No Conditions! Add from the menu...</p>',stripeRows:!1},columns:[{header:"Type".t(),menuDisabled:!0,dataIndex:"conditionType",align:"right",width:200,renderer:"conditionRenderer"},{xtype:"widgetcolumn",menuDisabled:!0,width:120,resizable:!1,widget:{xtype:"segmentedbutton",bind:"{record.invert}",items:[{text:"is".t(),value:!1},{text:"is NOT".t(),value:!0}]}},{header:"Value".t(),xtype:"widgetcolumn",menuDisabled:!0,sortable:!1,flex:1,widget:{xtype:"container",padding:"0 3"},onWidgetAttach:"onWidgetAttach"},{xtype:"actioncolumn",menuDisabled:!0,sortable:!1,width:30,align:"center",iconCls:"fa fa-minus-circle fa-red",tdCls:"action-cell-cond",handler:"removeCondition"}]},onBeforeRender:function(e){this.mainGrid=e.up("grid"),e.record?this.getViewModel().set({record:e.record.copy(null),windowTitle:"Edit".t()}):(e.record=Ext.create("Ung.model.Rule",Ext.clone(this.mainGrid.emptyRow)),e.record.set("markedForNew",!0),this.action="add",this.getViewModel().set({record:e.record,windowTitle:"Add".t()}))},onAfterRender:function(e){for(var t=this.mainGrid.editorFields,i=e.down("form"),n=0;n<t.length;n++)"conditions"!==t[n].dataIndex?i.add(t[n]):(i.add({xtype:"component",padding:"10 0 0 0",html:"<strong>"+"If all of the following conditions are met:".t()+"</strong>"}),i.add(this.conditionsGrid),i.add({xtype:"component",padding:"0 0 10 0",html:"<strong>"+(this.mainGrid.actionText||"Perform the following action(s):".t())+"</strong>"}))},onApply:function(){var e,t=this.getView(),i=this.getViewModel();if(!this.action){t.down("grid")&&(e=t.down("grid").getStore(),(e.getModifiedRecords().length>0||e.getRemovedRecords().length>0||e.getNewRecords().length>0)&&t.record.set("conditions",{javaClass:"java.util.LinkedList",list:Ext.Array.pluck(e.getRange(),"data")}));for(var n in i.get("record").modified)"conditions"!==n&&t.record.set(n,i.get("record").get(n))}"add"===this.action&&this.mainGrid.getStore().add(t.record),t.close()},onCancel:function(){this.getView().close()},onConditionsRender:function(e){var t,i=this.mainGrid.conditions,n=[];for(this.recordBind=this.getViewModel().bind({bindTo:"{record}"},this.setMenuConditions),t=0;t<i.length;t+=1)n.push({text:i[t].displayName,conditionType:i[t].name,index:t});e.down("#addConditionBtn").setMenu({showSeparator:!1,plain:!0,items:n,mouseLeaveDelay:0,listeners:{click:"addCondition"}})},setMenuConditions:function(){var e=this.getView().down("grid"),t=e.down("#addConditionBtn").getMenu(),i=e.getStore();t.items.each(function(e){e.setDisabled(!!i.findRecord("conditionType",e.conditionType))})},addCondition:function(e,t){var i={conditionType:t.conditionType,invert:!1,javaClass:this.getViewModel().get("ruleJavaClass"),value:""};this.getView().down("grid").getStore().add(i),this.setMenuConditions()},removeCondition:function(e,t,i,n,a,o){this.getView().down("grid").getStore().remove(o),this.setMenuConditions()},conditionRenderer:function(e){return"<strong>"+this.mainGrid.conditionsMap[e].displayName+":</strong>"},onWidgetAttach:function(e,t,i){t.removeAll(!0);var n,a=this.mainGrid.conditionsMap[i.get("conditionType")],o=[];switch(a.type){case"boolean":t.add({xtype:"component",padding:3,html:"True".t()});break;case"textfield":t.add({xtype:"textfield",style:{margin:0},bind:{value:"{record.value}"},vtype:a.vtype});break;case"numberfield":t.add({xtype:"numberfield",style:{margin:0},bind:{value:"{record.value}"},vtype:a.vtype});break;case"checkboxgroup":for(n=0;n<a.values.length;n+=1)o.push({inputValue:a.values[n][0],boxLabel:a.values[n][1]});t.add({xtype:"checkboxgroup",bind:{value:"{record.value}"},columns:4,vertical:!0,defaults:{padding:"0 10 0 0"},items:o})}},onDestroy:function(){console.log("destroy"),this.recordBind.destroy(),this.recordBind=null}}),Ext.define("Ung.overrides.form.CheckboxGroup",{override:"Ext.form.CheckboxGroup",setValue:function(e){var t,i,n,a,o=this,r=o.getBoxes(),s=r.length;return o.batchChanges(function(){for(Ext.suspendLayouts(),t=0;t<s;t++){if(i=r[t],n=i.getName(),a=!1,e){var o=e.split(",");a=Ext.isArray(o)?Ext.Array.contains(o,i.inputValue):o}i.setValue(a)}Ext.resumeLayouts(!0)}),o},getValue:function(){var e,t,i,n,a,o=[],r=this.getBoxes(),s=r.length;for(e=0;e<s;e++)t=r[e],i=t.getName(),n=t.inputValue,t.getValue()&&(o.hasOwnProperty(i)?(a=o[i],Ext.isArray(a)||(a=o[i]=[a]),a.push(n)):o.push(n));return o.join(",")}}),Ext.define("Ung.cmp.DateTime",{extend:"Ext.panel.Panel",alias:"widget.xdatetime",viewModel:{data:{value:""},formulas:{test:{get:function(e){return console.log("get"),e("value")},set:function(e){console.log("set"),this.set("value",e)}}}},items:[{xtype:"textfield",bind:"{test}"}]}),Ext.define("Ung.cmp.RecordEditor",{extend:"Ext.window.Window",width:800,height:500,xtype:"ung.cmp.recordeditor",requires:["Ung.cmp.RecordEditorController","Ung.overrides.form.CheckboxGroup","Ung.overrides.form.field.VTypes","Ung.cmp.DateTime"],controller:"recordeditor",closeAction:"destroy",viewModel:!0,disabled:!0,bind:{title:"{windowTitle}",disabled:"{!record}"},actions:{apply:{text:"Done".t(),formBind:!0,iconCls:"fa fa-check",handler:"onApply"},cancel:{text:"Cancel",iconCls:"fa fa-ban",handler:"onCancel"},addCondition:{itemId:"addConditionBtn",text:"Add Condition".t(),iconCls:"fa fa-plus"}},bodyStyle:{},autoShow:!0,modal:!0,constrain:!0,layout:"fit",items:[{xtype:"form",scrollable:"y",bodyPadding:10,border:!1,layout:"anchor",defaults:{anchor:"100%",labelWidth:180,labelAlign:"right"},items:[],buttons:["@cancel","@apply"]}]}),Ext.define("Ung.cmp.Grid",{extend:"Ext.grid.Panel",alias:"widget.ungrid",requires:["Ung.cmp.GridController","Ung.cmp.RecordEditor","Ung.cmp.DataImporter","Ung.model.Condition"],controller:"ungrid",actions:{add:{text:"Add".t(),iconCls:"fa fa-plus-circle fa-lg",handler:"addRecord"},addInline:{text:"Add".t(),iconCls:"fa fa-plus-circle fa-lg",handler:"addRecordInline"},import:{text:"Import".t(),handler:"importData"},export:{text:"Export".t(),handler:"exportData"},edit:{iconCls:"fa fa-pencil",tooltip:"Edit record".t(),handler:"editRecord",isDisabled:function(e,t,i,n,a){return a.get("readOnly")||!1}},delete:{iconCls:"fa fa-trash-o fa-red",tooltip:"Delete record".t(),handler:"deleteRecord",isDisabled:function(e,t,i,n,a){return a.get("readOnly")||!1}},moveUp:{iconCls:"fa fa-chevron-up",tooltip:"Move Up".t(),direction:-1,handler:"moveUp"},moveDown:{iconCls:"fa fa-chevron-down",tooltip:"Move Down".t(),direction:1,handler:"moveUp"}},layout:"fit",trackMouseOver:!1,sortableColumns:!1,enableColumnHide:!1,forceFit:!0,selModel:{type:"cellmodel"},viewConfig:{emptyText:'<p style="text-align: center; margin: 0; line-height: 2;"><i class="fa fa-exclamation-triangle fa-2x"></i> <br/>No Data! Add from the menu...</p>',stripeRows:!1,getRowClass:function(e){return e.get("markedForDelete")?"mark-delete":e.get("markedForNew")?"mark-new":e.get("readOnly")?"mark-readonly":void 0}},config:{},plugins:{ptype:"cellediting",clicksToEdit:1},initComponent:function(){var e,t=Ext.clone(this.columns);if(this.recordActions){for(e=0;e<this.recordActions.length;e+=1){var i=this.recordActions[e];"@edit"!==i&&"@delete"!==i||t.push({xtype:"actioncolumn",width:60,header:"@edit"===i?"Edit".t():"Delete".t(),align:"center",resizable:!1,tdCls:"action-cell",items:[i]}),"@reorder"===i&&(Ext.apply(this.viewConfig,{plugins:{ptype:"gridviewdragdrop",dragText:"Drag and drop to reorganize".t(),dragZone:{onBeforeDrag:function(e,t){return Ext.get(t.target).hasCls("fa-arrows")}}}}),t.unshift({xtype:"gridcolumn",header:'<i class="fa fa-sort"></i>',align:"center",width:30,resizable:!1,tdCls:"action-cell",renderer:function(){return'<i class="fa fa-arrows" style="cursor: move;"></i>'}}))}Ext.apply(this,{columns:t})}this.callParent(arguments)}}),Ext.define("Ung.config.network.Network",{extend:"Ext.tab.Panel",alias:"widget.config.network",requires:["Ung.config.network.NetworkController","Ung.config.network.NetworkModel","Ung.config.network.Interface","Ung.store.Rule","Ung.model.Rule","Ung.cmp.Grid"],controller:"config.network",viewModel:{type:"config.network"},dockedItems:[{xtype:"toolbar",weight:-10,border:!1,items:[{text:"Back",iconCls:"fa fa-arrow-circle-left fa-lg",hrefTarget:"_self",href:"#config"},"-",{xtype:"tbtext",html:"<strong>"+"Network".t()+"</strong>"}]},{xtype:"toolbar",dock:"bottom",border:!1,items:["->",{text:"Apply Changes".t(),scale:"large",iconCls:"fa fa-floppy-o fa-lg",handler:"saveSettings"}]}],items:[{xtype:"config.network.interfaces"},{xtype:"config.network.hostname"},{xtype:"config.network.services"},{xtype:"config.network.portforwardrules"},{xtype:"config.network.natrules"},{xtype:"config.network.bypassrules"},{xtype:"config.network.routes"},{xtype:"config.network.dnsserver"},{xtype:"config.network.dhcpserver"},{xtype:"config.network.advanced"},{xtype:"config.network.troubleshooting"}]}),Ext.define("Ung.chart.TimeChartController",{extend:"Ext.app.ViewController",alias:"controller.timechart",control:{"#":{resize:"onResize"}},styles:{LINE:{styleType:"spline"},AREA:{styleType:"areaspline"},AREA_STACKED:{styleType:"areaspline",stacking:!0},BAR:{styleType:"column",grouping:!0},BAR_OVERLAPPED:{styleType:"column",overlapped:!0},BAR_STACKED:{styleType:"column",stacking:!0}},init:function(){this.defaultColors=["#00b000","#3030ff","#009090","#00ffff","#707070","#b000b0","#fff000","#b00000","#ff0000","#ff6347","#c0c0c0"]},setChartType:function(e){var t="areaspline";switch(e){case"LINE":t="spline";break;case"AREA":case"AREA_STACKED":t="areaspline";break;case"BAR":case"BAR_3D":case"BAR_OVERLAPPED":case"BAR_3D_OVERLAPPED":case"BAR_STACKED":t="column";break;default:t="areaspline"}return t},onAfterRender:function(e){var t=this;this.entry=e.getViewModel().get("entry")||this.getView().getEntry(),this.chart=new Highcharts.StockChart({chart:{type:t.setChartType(t.entry.get("timeStyle")),zoomType:"x",renderTo:e.lookupReference("timechart").getEl().dom,marginTop:10,padding:[0,0,0,0],backgroundColor:"transparent",animation:!1,style:{fontFamily:"Source Sans Pro",fontSize:"12px"}},title:null,lang:{noData:""},noData:{style:{fontSize:"12px",fontWeight:"normal",color:"#CCC"}},colors:null!==t.entry.get("colors")&&t.entry.get("colors")>0?t.entry.get("colors"):t.defaultColors,navigator:{enabled:!1},rangeSelector:{enabled:!1,inputEnabled:!1},scrollbar:{enabled:!1},credits:{enabled:!1},navigation:{buttonOptions:{enabled:!1}},xAxis:[{type:"datetime",alternateGridColor:"rgba(220, 220, 220, 0.1)",crosshair:{width:1,dashStyle:"ShortDot",color:"rgba(100, 100, 100, 0.3)"},lineColor:"#C0D0E0",lineWidth:1,tickLength:3,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",labels:{style:{fontFamily:"Open Sans Condensed",color:"#555",fontSize:"10px",fontWeight:700},y:12},maxPadding:0,minPadding:0}],yAxis:{allowDecimals:!0,min:0,minRange:"percent"===t.entry.get("units")?100:.4,maxRange:"percent"===t.entry.get("units")?100:void 0,lineColor:"#C0D0E0",lineWidth:1,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",tickLength:5,tickWidth:1,showFirstLabel:!1,showLastLabel:!0,endOnTick:"percent"!==t.entry.get("units"),tickInterval:"percent"===t.entry.get("units")?20:void 0,maxPadding:0,opposite:!1,labels:{align:"right",useHTML:!0,padding:0,style:{fontFamily:"Open Sans Condensed",color:"#555",fontSize:"10px",fontWeight:600,background:"rgba(255, 255, 255, 0.6)",padding:"0 1px",borderRadius:"2px",lineHeight:"11px"},x:-10,y:5,formatter:function(){var e=this.value;return"bytes/s"===t.entry.get("units")&&(e=Util.bytesToHumanReadable(this.value,!0)),e}},title:{align:"high",offset:-10,y:3,text:t.entry.get("units"),style:{fontFamily:"Source Sans Pro",color:"#555",fontSize:"10px",fontWeight:600}}},legend:{enabled:!0,padding:5,margin:0,y:10,lineHeight:12,itemDistance:10,itemStyle:{fontFamily:"Source Sans Pro",color:"#555",fontSize:"12px",fontWeight:600},symbolHeight:7,symbolWidth:7,symbolRadius:3},tooltip:{shared:!0,animation:!0,followPointer:!0,backgroundColor:"rgba(255, 255, 255, 0.7)",borderWidth:1,borderColor:"rgba(0, 0, 0, 0.1)",style:{textAlign:"right",fontFamily:"Source Sans Pro",padding:"5px",fontSize:"10px",marginBottom:"40px"},hideDelay:0,shadow:!1,headerFormat:'<span style="font-size: 11px; line-height: 1.5; font-weight: bold;">{point.key}</span><br/>',pointFormatter:function(){var e="<span>"+this.series.name+"</span>";return e+="bytes"===t.entry.get("units")||"bytes/s"===t.entry.get("units")?': <span style="color: '+this.color+'; font-weight: bold;">'+this.y+"</span>":': <spanstyle="color: '+this.color+'; font-weight: bold;">'+this.y+"</span> "+t.entry.get("units"),e+"<br/>"}},plotOptions:{column:{edgeWidth:0,borderWidth:0,pointPadding:0,groupPadding:.2,dataGrouping:{groupPixelWidth:40},pointPlacement:"on",dataLabels:{enabled:!1,align:"left",rotation:-45,x:0,y:-2,style:{fontSize:"9px",color:"#999",textShadow:!1}}},areaspline:{lineWidth:0},spline:{lineWidth:2,softThreshold:!1},series:{animation:!1,marker:{enabled:!0,radius:0,states:{hover:{enabled:!0,lineWidthPlus:2,radius:4,radiusPlus:2}}},states:{hover:{enabled:!0,lineWidthPlus:0,halo:{size:2}}}}}})},onResize:function(){this.chart.reflow()},onSetSeries:function(e){var t,i,n,a=this,o=[],r=Ext.clone(this.entry.get("timeDataColumns")),s=this.entry.get("timeStyle"),d=this.entry.get("colors")||this.defaultColors;if(this.getView().lookupReference("loader").hide(),r)for(t=0;t<r.length;t+=1)r[t]=r[t].split(" ").splice(-1)[0];else for(r=[],i=0;i<e.length;i+=1)for(n in e[i])e[i].hasOwnProperty(n)&&"time_trunc"!==n&&"time"!==n&&r.indexOf(n)<0&&r.push(n);for(t=0;t<r.length;t+=1){for(o=[],i=0;i<e.length;i+=1)o.push([e[i].time_trunc.time,e[i][r[t]]||0]);this.chart.get("series-"+r[t])?this.chart.get("series-"+r[t]).update({data:o,type:a.styles[s].styleType,color:d[t]||void 0,fillOpacity:"AREA_STACKED"===s||"BAR_STACKED"===s?1:.5,grouping:a.styles[s].grouping||!1,stacking:a.styles[s].stacking||void 0,pointPadding:a.styles[s].overlapped?(r.length<=3?.1:.075)*t:.1,visible:!("total"===r[t]&&a.styles[s].stacking)}):this.chart.addSeries({id:"series-"+r[t],name:r[t],data:o,type:a.styles[s].styleType,color:d[t]||void 0,fillOpacity:"AREA_STACKED"===s||"BAR_STACKED"===s?1:.5,grouping:a.styles[s].grouping||!1,stacking:a.styles[s].stacking||void 0,pointPlacement:0,pointPadding:a.styles[s].overlapped?(r.length<=3?.12:.075)*(t+1):.1,visible:!("total"===r[t]&&a.styles[s].stacking)},!1,!1)}this.chart.redraw()},onSetStyle:function(){var e=this,t=e.getViewModel().get("entry.timeStyle"),i=e.getViewModel().get("entry.colors")||this.defaultColors;if(this.chart){var n=this.chart.series.length;this.chart.series.forEach(function(a,o){a.update({type:e.styles[t].styleType,color:i[o]||void 0,fillOpacity:"AREA_STACKED"===t||"BAR_STACKED"===t?1:.5,grouping:e.styles[t].grouping||!1,stacking:e.styles[t].stacking||void 0,pointPadding:e.styles[t].overlapped?(n<=3?.15:.075)*o:.1,visible:!("total"===a.name&&e.styles[t].stacking)})})}},onBeginFetchData:function(){this.getView().lookupReference("loader").show()}}),Ext.define("Ung.chart.TimeChart",{extend:"Ext.container.Container",alias:"widget.timechart",requires:["Ung.chart.TimeChartController"],controller:"timechart",viewModel:!0,config:{widget:null,entry:null},listeners:{afterrender:"onAfterRender",resize:"onResize",setseries:"onSetSeries",beginfetchdata:"onBeginFetchData"},items:[{xtype:"component",reference:"timechart",cls:"chart"},{xtype:"component",reference:"loader",cls:"loader",hideMode:"visibility"}]}),Ext.define("Ung.chart.PieChartController",{extend:"Ext.app.ViewController",alias:"controller.piechart",styles:{LINE:{styleType:"spline"},AREA:{styleType:"areaspline"},AREA_STACKED:{styleType:"areaspline",stacking:!0},BAR:{styleType:"column",grouping:!0},BAR_OVERLAPPED:{styleType:"column",overlapped:!0},BAR_STACKED:{styleType:"column",stacking:!0}},init:function(){this.defaultColors=["#00b000","#3030ff","#009090","#00ffff","#707070","#b000b0","#fff000","#b00000","#ff0000","#ff6347","#c0c0c0"]},onAfterRender:function(e){var t=this;this.entry=e.getViewModel().get("entry")||this.getView().getEntry(),this.chart=new Highcharts.Chart({chart:{type:t.entry.get("pieStyle").indexOf("COLUMN")>=0?"column":"pie",renderTo:e.lookupReference("piechart").getEl().dom,marginTop:10,marginRight:0,marginLeft:0,backgroundColor:"transparent",style:{fontFamily:"Source Sans Pro",fontSize:"12px"},options3d:{enabled:!1,alpha:45,beta:5}},title:null,lang:{noData:""},noData:{style:{fontSize:"12px",fontWeight:"normal",color:"#CCC"}},colors:null!==t.entry.get("colors")&&t.entry.get("colors")>0?t.entry.get("colors"):this.defaultColors,credits:{enabled:!1},navigation:{buttonOptions:{enabled:!1}},xAxis:{type:"category",crosshair:!0,alternateGridColor:"rgba(220, 220, 220, 0.1)",labels:{style:{fontSize:"11px"}},lineColor:"#C0D0E0",lineWidth:1,tickLength:3,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",maxPadding:0,minPadding:0},yAxis:{lineColor:"#C0D0E0",lineWidth:1,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",tickLength:5,tickWidth:1,tickPosition:"inside",showFirstLabel:!1,showLastLabel:!0,endOnTick:!0,labels:{align:"left",useHTML:!0,padding:0,style:{fontFamily:"Source Sans Pro",color:"#555",fontSize:"11px",fontWeight:600,background:"rgba(255, 255, 255, 0.6)",padding:"0 1px",borderRadius:"2px",lineHeight:"11px"},x:9,y:6,formatter:function(){return this.isLast?'<span style="color: #555; font-size: 12px;"><strong>'+this.value+"</strong> ("+t.entry.get("units")+")</span>":this.value}}},tooltip:{headerFormat:'<span style="font-size: 14px; font-weight: bold;">aaa : {point.key}</span><br/>',hideDelay:0},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",center:["50%","50%"],showInLegend:!0,colorByPoint:!0,minSize:150,borderWidth:1,borderColor:"#EEE",dataLabels:{enabled:!0,distance:5,padding:0,reserveSpace:!1,style:{fontSize:"11px",color:"#777",fontFamily:"Source Sans Pro",fontWeight:400},formatter:function(){return this.point.percentage<3?null:this.point.name.length>25?this.point.name.substring(0,25)+"...":this.point.name}}},column:{borderWidth:0,colorByPoint:!0,depth:25,dataLabels:{enabled:!1,align:"center"}},series:{animation:!1}},legend:{enabled:!1,backgroundColor:"#EEE",borderRadius:3,padding:15,style:{overflow:"hidden"},title:{text:"aaa",style:{fontSize:"14px"}},itemStyle:{fontSize:"11px",width:"120px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},useHTML:!0,layout:"vertical",align:"left",verticalAlign:"top",symbolHeight:8,symbolWidth:8,symbolRadius:4}})},onResize:function(){this.chart.reflow()},onSetSeries:function(e){for(this.getView().lookupReference("loader").hide();this.chart.series.length>0;)this.chart.series[0].remove(!0);var t,i=[],n=0;for(t=0;t<e.length;t+=1)t<this.entry.get("pieNumSlices")?i.push({name:void 0!==e[t][this.entry.get("pieGroupColumn")]?e[t][this.entry.get("pieGroupColumn")]:"None",y:e[t].value}):n+=e[t].value;n>0&&i.push({name:"Other",color:"#DDD",y:n}),this.chart.addSeries({name:"aaa",type:this.entry.get("pieStyle").indexOf("COLUMN")>=0?"column":"pie",colors:this.entry.get("colors")||this.defaultColors,innerSize:this.entry.get("pieStyle").indexOf("DONUT")>=0?"50%":0,data:i},!0,!0)},onSetStyle:function(){var e=this,t=e.getViewModel().get("entry.pieStyle"),i=e.getViewModel().get("entry.colors")||this.defaultColors;this.chart&&this.chart.series[0].update({type:t.indexOf("COLUMN")>=0?"column":"pie",colors:i,innerSize:t.indexOf("DONUT")>=0?"50%":0})},onBeginFetchData:function(){this.getView().lookupReference("loader").show()}}),Ext.define("Ung.chart.PieChart",{extend:"Ext.container.Container",alias:"widget.piechart",requires:["Ung.chart.PieChartController"],controller:"piechart",viewModel:!0,config:{widget:null,entry:null},listeners:{afterrender:"onAfterRender",resize:"onResize",setseries:"onSetSeries",beginfetchdata:"onBeginFetchData"},items:[{xtype:"component",reference:"piechart",cls:"chart"},{xtype:"component",reference:"loader",cls:"loader",hideMode:"visibility",html:'<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>'}]}),Ext.define("Ung.chart.EventChartController",{extend:"Ext.app.ViewController",alias:"controller.eventchart",control:{"#":{setdata:"onSetData",beginfetchdata:"onBeforeData"
}},onBeforeData:function(){this.getView().setLoading("Querying Database...".t())},onSetData:function(e){this.getView().setLoading(!1),this.getViewModel().set("customData",e)}}),Ext.define("Ung.util.TableConfig",{alternateClassName:"Ung.TableConfig",singleton:!0,columnWidth:{hostname:120,ip:100,port:70,timestamp:135,username:120},table:{sessions:["session_id","time_stamp","end_time","bypassed","entitled","protocol","icmp_type","hostname","username","policy_id","policy_rule_id","c_client_addr","c_client_port","c_server_addr","c_server_port","s_client_addr","s_client_port","s_server_addr","s_server_port","client_intf","server_intf","client_country","client_latitude","client_longitude","server_country","server_latitude","server_longitude","c2p_bytes","p2c_bytes","s2p_bytes","p2s_bytes","filter_prefix","firewall_blocked","firewall_flagged","firewall_rule_index","application_control_lite_blocked","application_control_lite_protocol","captive_portal_rule_index","captive_portal_blocked","application_control_application","application_control_protochain","application_control_category","application_control_flagged","application_control_blocked","application_control_confidence","application_control_detail","application_control_ruleid","bandwidth_control_priority","bandwidth_control_rule","ssl_inspector_status","ssl_inspector_detail","ssl_inspector_ruleid"],session_minutes:["session_id","time_stamp","end_time","bypassed","entitled","protocol","icmp_type","hostname","username","policy_id","policy_rule_id","c_client_addr","c_client_port","c_server_addr","c_server_port","s_client_addr","s_client_port","s_server_addr","s_server_port","client_intf","server_intf","client_country","client_latitude","client_longitude","server_country","server_latitude","server_longitude","c2p_bytes","p2c_bytes","s2p_bytes","p2s_bytes","filter_prefix","firewall_blocked","firewall_flagged","firewall_rule_index","application_control_lite_blocked","application_control_lite_protocol","captive_portal_rule_index","captive_portal_blocked","application_control_application","application_control_protochain","application_control_category","application_control_flagged","application_control_blocked","application_control_confidence","application_control_detail","application_control_ruleid","bandwidth_control_priority","bandwidth_control_rule","ssl_inspector_status","ssl_inspector_detail","ssl_inspector_ruleid"],http_events:["request_id","policy_id","time_stamp","session_id","client_intf","server_intf","c_client_addr","c_client_port","c_server_addr","c_server_port","s_client_addr","s_client_port","s_server_addr","s_server_port","username","hostname","method","domain","host","uri","referer","c2s_content_length","s2c_content_length","s2c_content_type","web_filter_lite_blocked","web_filter_blocked","web_filter_lite_flagged","web_filter_flagged","web_filter_lite_category","web_filter_category","web_filter_lite_reason","web_filter_reason","ad_blocker_action","ad_blocker_cookie_ident","virus_blocker_clean","virus_blocker_name","virus_blocker_lite_clean","virus_blocker_lite_name"]},getColumns:function(){return{c_client_port:{header:"Client Port".t(),width:this.columnWidth.port,renderer:function(e){return Ung.TableConfig.protocols[e]||e}},hostname:{header:"Hostname".t(),width:this.columnWidth.hostname},protocol:{header:"Protocol".t(),width:this.columnWidth.port,renderer:function(e){return Ung.TableConfig.protocols[e]||e}},s_server_addr:{header:"Server".t(),width:this.columnWidth.ip},s_server_port:{header:"Server Port".t(),width:this.columnWidth.port},session_id:{header:"Session Id".t()},time_stamp:{header:"Timestamp".t(),width:this.columnWidth.timestamp,renderer:function(e){var t=new Date(e.time);return Ext.Date.format(t,"M d, H:i:s.u")}},username:{header:"Username".t(),width:this.columnWidth.username}}},protocols:{0:"HOPOPT (0)",1:"ICMP (1)",2:"IGMP (2)",3:"GGP (3)",4:"IP-in-IP (4)",5:"ST (5)",6:"TCP (6)",7:"CBT (7)",8:"EGP (8)",9:"IGP (9)",10:"BBN-RCC-MON (10)",11:"NVP-II (11)",12:"PUP (12)",13:"ARGUS (13)",14:"EMCON (14)",15:"XNET (15)",16:"CHAOS (16)",17:"UDP (17)",18:"MUX (18)",19:"DCN-MEAS (19)",20:"HMP (20)",21:"PRM (21)",22:"XNS-IDP (22)",23:"TRUNK-1 (23)",24:"TRUNK-2 (24)",25:"LEAF-1 (25)",26:"LEAF-2 (26)",27:"RDP (27)",28:"IRTP (28)",29:"ISO-TP4 (29)",30:"NETBLT (30)",31:"MFE-NSP (31)",32:"MERIT-INP (32)",33:"DCCP (33)",34:"3PC (34)",35:"IDPR (35)",36:"XTP (36)",37:"DDP (37)",38:"IDPR-CMTP (38)",39:"TP++ (39)",40:"IL (40)",41:"IPv6 (41)",42:"SDRP (42)",43:"IPv6-Route (43)",44:"IPv6-Frag (44)",45:"IDRP (45)",46:"RSVP (46)",47:"GRE (47)",48:"MHRP (48)",49:"BNA (49)",50:"ESP (50)",51:"AH (51)",52:"I-NLSP (52)",53:"SWIPE (53)",54:"NARP (54)",55:"MOBILE (55)",56:"TLSP (56)",57:"SKIP (57)",58:"IPv6-ICMP (58)",59:"IPv6-NoNxt (59)",60:"IPv6-Opts (60)",62:"CFTP (62)",64:"SAT-EXPAK (64)",65:"KRYPTOLAN (65)",66:"RVD (66)",67:"IPPC (67)",69:"SAT-MON (69)",70:"VISA (70)",71:"IPCU (71)",72:"CPNX (72)",73:"CPHB (73)",74:"WSN (74)",75:"PVP (75)",76:"BR-SAT-MON (76)",77:"SUN-ND (77)",78:"WB-MON (78)",79:"WB-EXPAK (79)",80:"ISO-IP (80)",81:"VMTP (81)",82:"SECURE-VMTP (82)",83:"VINES (83)",84:"TTP (84)",85:"NSFNET-IGP (85)",86:"DGP (86)",87:"TCF (87)",88:"EIGRP (88)",89:"OSPF (89)",90:"Sprite-RPC (90)",91:"LARP (91)",92:"MTP (92)",93:"AX.25 (93)",94:"IPIP (94)",95:"MICP (95)",96:"SCC-SP (96)",97:"ETHERIP (97)",98:"ENCAP (98)",100:"GMTP (100)",101:"IFMP (101)",102:"PNNI (102)",103:"PIM (103)",104:"ARIS (104)",105:"SCPS (105)",106:"QNX (106)",107:"A/N (107)",108:"IPComp (108)",109:"SNP (109)",110:"Compaq-Peer (110)",111:"IPX-in-IP (111)",112:"VRRP (112)",113:"PGM (113)",115:"L2TP (115)",116:"DDX (116)",117:"IATP (117)",118:"STP (118)",119:"SRP (119)",120:"UTI (120)",121:"SMP (121)",122:"SM (122)",123:"PTP (123)",124:"IS-IS (124)",125:"FIRE (125)",126:"CRTP (126)",127:"CRUDP (127)",128:"SSCOPMCE (128)",129:"IPLT (129)",130:"SPS (130)",131:"PIPE (131)",132:"SCTP (132)",133:"FC (133)",134:"RSVP-E2E-IGNORE (134)",135:"Mobility (135)",136:"UDPLite (136)",137:"MPLS-in-IP (137)",138:"manet (138)",139:"HIP (139)",140:"Shim6 (140)",141:"WESP (141)",142:"ROHC (142)"}}),Ext.define("Ung.chart.EventChart",{extend:"Ext.grid.Panel",alias:"widget.eventchart",requires:["Ung.chart.EventChartController","Ung.util.TableConfig"],controller:"eventchart",viewModel:{stores:{store:{data:"{customData}"}}},plugins:"gridfilters",config:{entry:null},bind:{store:"{store}"},border:!1,initComponent:function(){var e,t=this,i=[],n=Ung.TableConfig.getColumns();Ung.TableConfig.table[t.getEntry().get("table")].forEach(function(a){e=n[a]||{header:a},Ext.apply(e,{dataIndex:a,hidden:!Ext.Array.contains(t.getEntry().get("defaultColumns"),a)}),i.push(e)}),Ext.apply(this,{columns:i}),this.callParent(arguments)}}),Ext.define("Ung.widget.Report",{extend:"Ext.container.Container",alias:"widget.reportwidget",requires:["Ung.widget.ReportModel","Ung.chart.TimeChart","Ung.chart.PieChart","Ung.chart.EventChart"],controller:"widget",viewModel:{type:"reportwidget"},config:{widget:null,entry:null},hidden:!0,bind:{hidden:"{!widget.enabled}"},layout:{type:"vbox",align:"stretch"},border:!1,baseCls:"widget adding",items:[{xtype:"component",cls:"header",itemId:"header",bind:{html:'{title}<button class="action-btn"><i class="fa fa-refresh" data-action="refresh"></i></button>'}}],fetchData:function(){var e=this,t=this.getViewModel();if(t){var i=t.get("entry"),n=t.get("widget.timeframe");"EVENT_LIST"===i.get("type")?e.fireEvent("afterdata"):(this.lookupReference("chart").fireEvent("beginfetchdata"),Rpc.asyncData("rpc.reportsManager.getDataForReportEntry",i.getData(),n,-1).then(function(t){e.fireEvent("afterdata"),e.lookupReference("chart").fireEvent("setseries",t.list)},function(t){console.log(t),e.fireEvent("afterdata"),e.lookupReference("chart").lookupReference("loader").hide(),e.down("#exception")&&e.remove("exception"),e.add({xtype:"component",itemId:"exception",cls:"exception",scrollable:!0,html:'<h3><i class="material-icons">error</i> <span>'+"Widget error".t()+"</span></h3><p>"+"There was an issue while fetching data!".t()+"</p>"})}))}}}),Ext.define("Ung.view.dashboard.Dashboard",{extend:"Ext.container.Container",xtype:"ung.dashboard",itemId:"dashboard",requires:["Ung.view.dashboard.DashboardController","Ung.view.dashboard.Queue","Ung.widget.Report","Ung.widget.WidgetController","Ung.widget.Information","Ung.widget.Resources","Ung.widget.CpuLoad","Ung.widget.NetworkInformation","Ung.widget.NetworkLayout","Ung.widget.MapDistribution"],controller:"dashboard",viewModel:!0,config:{settings:null},layout:"border",defaults:{border:!1},items:[{region:"west",title:"Manage Widgets".t(),width:300,collapsible:!0,bodyBorder:!0,animCollapse:!1,collapsed:!0,titleCollapse:!0,floatable:!1,cls:"widget-manager",split:!0,xtype:"grid",reference:"dashboardNav",hideHeaders:!0,store:"widgets",bodyStyle:{border:0},viewConfig:{plugins:{ptype:"gridviewdragdrop",dragText:"Drag and drop to reorganize".t(),dragZone:{onBeforeDrag:function(e,t){return Ext.get(t.target).hasCls("drag-handle")}}},stripeRows:!1,getRowClass:function(e){return e.get("enabled")?"":"disabled"},listeners:{drop:"onDrop"}},columns:[{width:14,align:"center",sortable:!1,hideable:!1,resizable:!1,menuDisabled:!0,tdCls:"drag-handle"},{width:30,align:"center",sortable:!1,hideable:!1,resizable:!1,menuDisabled:!0,dataIndex:"enabled",renderer:"enableRenderer"},{dataIndex:"entryId",renderer:"widgetTitleRenderer",flex:1},{xtype:"actioncolumn",width:30,align:"center",sortable:!1,hideable:!1,resizable:!1,menuDisabled:!0,handler:"removeWidget",renderer:function(e,t,i){return'<i class="fa fa-times" style="color: #999; font-size: 20px;"></i>'}}],listeners:{itemmouseleave:"onItemLeave",cellclick:"onItemClick"},tbar:[{itemId:"addWidgetBtn",text:"Add".t(),iconCls:"fa fa-plus-circle"},"->",{text:"Import".t(),iconCls:"fa fa-download"},{text:"Export".t(),iconCls:"fa fa-upload"}],bbar:[{text:"Reset".t(),iconCls:"fa fa-rotate-left",handler:"resetDashboard"},"->",{text:"Apply".t(),iconCls:"fa fa-floppy-o",handler:"applyChanges"}]},{xtype:"container",region:"center",reference:"dashboard",cls:"dashboard",padding:8,scrollable:!0}],listeners:{showwidgeteditor:"showWidgetEditor"}}),Ext.define("Ung.view.main.Main",{extend:"Ext.panel.Panel",itemId:"main",requires:["Ung.view.main.MainController","Ung.view.main.MainModel","Ung.view.dashboard.Dashboard","Ung.view.apps.Apps","Ung.view.config.Config","Ung.view.reports.Reports"],controller:"main",viewModel:{type:"main"},layout:"card",border:!1,bind:{activeItem:"{activeItem}"},items:[{xtype:"ung.dashboard"},{xtype:"ung.apps"},{xtype:"ung.config"},{xtype:"ung.reports"},{},{}],dockedItems:[{xtype:"toolbar",ui:"navigation",dock:"top",border:!1,defaults:{xtype:"button",border:!1,enableToggle:!0,iconAlign:"top",hrefTarget:"_self"},items:[{html:'<img src="'+resourcesBaseHref+'/images/BrandingLogo.png" style="height: 40px;"/>',cls:"logo"},{text:"Dashboard".t(),iconCls:"fa fa-home",cls:"upper",href:"#",bind:{pressed:'{selectedNavItem === "dashboard"}'}},{text:"Apps".t(),iconCls:"fa fa-th",cls:"upper",bind:{href:"#apps/{policyId}",pressed:'{selectedNavItem === "apps"}'}},{text:"Config".t(),iconCls:"fa fa-sliders",cls:"upper",href:"#config",bind:{pressed:'{selectedNavItem === "config"}'}},{text:"Reports".t(),iconCls:"fa fa-line-chart",cls:"upper",href:"#reports",bind:{pressed:'{selectedNavItem === "reports"}'}},"->",{text:"Sessions".t(),iconCls:"fa fa-list",href:"#sessions",bind:{pressed:'{selectedNavItem === "sessions"}'}},{text:"Hosts".t(),iconCls:"fa fa-th-list",href:"#hosts",bind:{pressed:'{selectedNavItem === "hosts"}'}},{text:"Devices".t(),iconCls:"fa fa-desktop",href:"#devices",bind:{pressed:'{selectedNavItem === "devices"}'}},"-",{text:"Help".t(),iconCls:"fa fa-question-circle"},{text:"Account".t(),iconCls:"fa fa-user-circle"}]}]}),Ext.define("Ung.store.Metrics",{extend:"Ext.data.Store",storeId:"metrics",proxy:{type:"memory",reader:{type:"json"}}}),Ext.define("Ung.store.Hosts",{extend:"Ext.data.Store",storeId:"hosts",fields:[{name:"address",type:"string"}],proxy:{autoLoad:!0,type:"memory",reader:{type:"json"}}}),Ext.define("Ung.store.Conditions",{extend:"Ext.data.Store",storeId:"conditions",fields:["name","displayName","type"],data:[{name:"DST_ADDR",displayName:"Destination Address".t(),editorType:"textfield",vtype:"ipall",visible:!0},{name:"DST_PORT",displayName:"Destination Port".t(),editorType:"textfield",vtype:"port",visible:!0},{name:"DST_INTF",displayName:"Destination Interface".t(),editorType:"checkgroup",visible:!0},{name:"SRC_ADDR",displayName:"Source Address".t(),editorType:"textfield",visible:!0,vtype:"ipall"},{name:"SRC_PORT",displayName:"Source Port".t(),editorType:"textfield",vtype:"portMatcher",visible:rpc.isExpertMode},{name:"SRC_INTF",displayName:"Source Interface".t(),editorType:"checkgroup",visible:!0},{name:"PROTOCOL",displayName:"Protocol".t(),editorType:"checkgroup",values:[["TCP","TCP"],["UDP","UDP"],["any","any"]],visible:!0},{name:"USERNAME",displayName:"Username".t(),editorType:"userselection",visible:!0},{name:"CLIENT_HOSTNAME",displayName:"Client Hostname".t(),editorType:"textfield",visible:!0},{name:"SERVER_HOSTNAME",displayName:"Server Hostname".t(),editorType:"textfield",visible:rpc.isExpertMode},{name:"SRC_MAC",displayName:"Client MAC Address".t(),editorType:"textfield",visible:!0},{name:"DST_MAC",displayName:"Server MAC Address".t(),editorType:"textfield",visible:!0},{name:"CLIENT_MAC_VENDOR",displayName:"Client MAC Vendor".t(),editorType:"textfield",visible:!0},{name:"SERVER_MAC_VENDOR",displayName:"Server MAC Vendor".t(),editorType:"textfield",visible:!0},{name:"CLIENT_IN_PENALTY_BOX",displayName:"Client in Penalty Box".t(),editorType:"boolean",visible:!0},{name:"SERVER_IN_PENALTY_BOX",displayName:"Server in Penalty Box".t(),editorType:"boolean",visible:!0},{name:"CLIENT_HAS_NO_QUOTA",displayName:"Client has no Quota".t(),editorType:"boolean",visible:!0},{name:"SERVER_HAS_NO_QUOTA",displayName:"Server has no Quota".t(),editorType:"boolean",visible:!0},{name:"CLIENT_QUOTA_EXCEEDED",displayName:"Client has exceeded Quota".t(),editorType:"boolean",visible:!0},{name:"SERVER_QUOTA_EXCEEDED",displayName:"Server has exceeded Quota".t(),editorType:"boolean",visible:!0},{name:"CLIENT_QUOTA_ATTAINMENT",displayName:"Client Quota Attainment".t(),editorType:"textfield",visible:!0},{name:"SERVER_QUOTA_ATTAINMENT",displayName:"Server Quota Attainment".t(),editorType:"textfield",visible:!0},{name:"HTTP_HOST",displayName:"HTTP: Hostname".t(),editorType:"textfield",visible:!0},{name:"HTTP_REFERER",displayName:"HTTP: Referer".t(),editorType:"textfield",visible:!0},{name:"HTTP_URI",displayName:"HTTP: URI".t(),editorType:"textfield",visible:!0},{name:"HTTP_URL",displayName:"HTTP: URL".t(),editorType:"textfield",visible:!0},{name:"HTTP_CONTENT_TYPE",displayName:"HTTP: Content Type".t(),editorType:"textfield",visible:!0},{name:"HTTP_CONTENT_LENGTH",displayName:"HTTP: Content Length".t(),editorType:"textfield",visible:!0},{name:"HTTP_USER_AGENT",displayName:"HTTP: Client User Agent".t(),editorType:"textfield",visible:!0},{name:"HTTP_USER_AGENT_OS",displayName:"HTTP: Client User OS".t(),editorType:"textfield",visible:!1},{name:"APPLICATION_CONTROL_APPLICATION",displayName:"Application Control: Application".t(),editorType:"textfield",visible:!0},{name:"APPLICATION_CONTROL_CATEGORY",displayName:"Application Control: Application Category".t(),editorType:"textfield",visible:!0},{name:"APPLICATION_CONTROL_PROTOCHAIN",displayName:"Application Control: Protochain".t(),editorType:"textfield",visible:!0},{name:"APPLICATION_CONTROL_DETAIL",displayName:"Application Control: Detail".t(),editorType:"textfield",visible:!0},{name:"APPLICATION_CONTROL_CONFIDENCE",displayName:"Application Control: Confidence".t(),editorType:"textfield",visible:!0},{name:"APPLICATION_CONTROL_PRODUCTIVITY",displayName:"Application Control: Productivity".t(),editorType:"textfield",visible:!0},{name:"APPLICATION_CONTROL_RISK",displayName:"Application Control: Risk".t(),editorType:"textfield",visible:!0},{name:"PROTOCOL_CONTROL_SIGNATURE",displayName:"Application Control Lite: Signature".t(),editorType:"textfield",visible:!0},{name:"PROTOCOL_CONTROL_CATEGORY",displayName:"Application Control Lite: Category".t(),editorType:"textfield",visible:!0},{name:"PROTOCOL_CONTROL_DESCRIPTION",displayName:"Application Control Lite: Description".t(),editorType:"textfield",visible:!0},{name:"WEB_FILTER_CATEGORY",displayName:"Web Filter: Category".t(),editorType:"textfield",visible:!0},{name:"WEB_FILTER_CATEGORY_DESCRIPTION",displayName:"Web Filter: Category Description".t(),editorType:"textfield",visible:!0},{name:"WEB_FILTER_FLAGGED",displayName:"Web Filter: Website is Flagged".t(),editorType:"boolean",visible:!0},{name:"DIRECTORY_CONNECTOR_GROUP",displayName:"Directory Connector: User in Group".t(),type:"editor",visible:!0},{name:"CLIENT_COUNTRY",displayName:"Client Country".t(),editorType:"countryselector",visible:!0},{name:"SERVER_COUNTRY",displayName:"Server Country".t(),editorType:"countryselector",visible:!0}]}),Ext.define("Ung.store.Countries",{extend:"Ext.data.Store",storeId:"countries",data:[{code:"AF",name:"Afghanistan".t()},{code:"AX",name:"Aland Islands".t()},{code:"AL",name:"Albania".t()},{code:"DZ",name:"Algeria".t()},{code:"AS",name:"American Samoa".t()},{code:"AD",name:"Andorra".t()},{code:"AO",name:"Angola".t()},{code:"AI",name:"Anguilla".t()},{code:"AQ",name:"Antarctica".t()},{code:"AG",name:"Antigua and Barbuda".t()},{code:"AR",name:"Argentina".t()},{code:"AM",name:"Armenia".t()},{code:"AW",name:"Aruba".t()},{code:"AU",name:"Australia".t()},{code:"AT",name:"Austria".t()},{code:"AZ",name:"Azerbaijan".t()},{code:"BS",name:"Bahamas".t()},{code:"BH",name:"Bahrain".t()},{code:"BD",name:"Bangladesh".t()},{code:"BB",name:"Barbados".t()},{code:"BY",name:"Belarus".t()},{code:"BE",name:"Belgium".t()},{code:"BZ",name:"Belize".t()},{code:"BJ",name:"Benin".t()},{code:"BM",name:"Bermuda".t()},{code:"BT",name:"Bhutan".t()},{code:"BO",name:"Bolivia, Plurinational State of".t()},{code:"BQ",name:"Bonaire, Sint Eustatius and Saba".t()},{code:"BA",name:"Bosnia and Herzegovina".t()},{code:"BW",name:"Botswana".t()},{code:"BV",name:"Bouvet Island".t()},{code:"BR",name:"Brazil".t()},{code:"IO",name:"British Indian Ocean Territory".t()},{code:"BN",name:"Brunei Darussalam".t()},{code:"BG",name:"Bulgaria".t()},{code:"BF",name:"Burkina Faso".t()},{code:"BI",name:"Burundi".t()},{code:"KH",name:"Cambodia".t()},{code:"CM",name:"Cameroon".t()},{code:"CA",name:"Canada".t()},{code:"CV",name:"Cape Verde".t()},{code:"KY",name:"Cayman Islands".t()},{code:"CF",name:"Central African Republic".t()},{code:"TD",name:"Chad".t()},{code:"CL",name:"Chile".t()},{code:"CN",name:"China".t()},{code:"CX",name:"Christmas Island".t()},{code:"CC",name:"Cocos (Keeling) Islands".t()},{code:"CO",name:"Colombia".t()},{code:"KM",name:"Comoros".t()},{code:"CG",name:"Congo".t()},{code:"CD",name:"Congo, the Democratic Republic of the".t()},{code:"CK",name:"Cook Islands".t()},{code:"CR",name:"Costa Rica".t()},{code:"CI",name:"Cote d'Ivoire".t()},{code:"HR",name:"Croatia".t()},{code:"CU",name:"Cuba".t()},{code:"CW",name:"Curacao".t()},{code:"CY",name:"Cyprus".t()},{code:"CZ",name:"Czech Republic".t()},{code:"DK",name:"Denmark".t()},{code:"DJ",name:"Djibouti".t()},{code:"DM",name:"Dominica".t()},{code:"DO",name:"Dominican Republic".t()},{code:"EC",name:"Ecuador".t()},{code:"EG",name:"Egypt".t()},{code:"SV",name:"El Salvador".t()},{code:"GQ",name:"Equatorial Guinea".t()},{code:"ER",name:"Eritrea".t()},{code:"EE",name:"Estonia".t()},{code:"ET",name:"Ethiopia".t()},{code:"FK",name:"Falkland Islands (Malvinas)".t()},{code:"FO",name:"Faroe Islands".t()},{code:"FJ",name:"Fiji".t()},{code:"FI",name:"Finland".t()},{code:"FR",name:"France".t()},{code:"GF",name:"French Guiana".t()},{code:"PF",name:"French Polynesia".t()},{code:"TF",name:"French Southern Territories".t()},{code:"GA",name:"Gabon".t()},{code:"GM",name:"Gambia".t()},{code:"GE",name:"Georgia".t()},{code:"DE",name:"Germany".t()},{code:"GH",name:"Ghana".t()},{code:"GI",name:"Gibraltar".t()},{code:"GR",name:"Greece".t()},{code:"GL",name:"Greenland".t()},{code:"GD",name:"Grenada".t()},{code:"GP",name:"Guadeloupe".t()},{code:"GU",name:"Guam".t()},{code:"GT",name:"Guatemala".t()},{code:"GG",name:"Guernsey".t()},{code:"GN",name:"Guinea".t()},{code:"GW",name:"Guinea-Bissau".t()},{code:"GY",name:"Guyana".t()},{code:"HT",name:"Haiti".t()},{code:"HM",name:"Heard Island and McDonald Islands".t()},{code:"VA",name:"Holy See (Vatican City State)".t()},{code:"HN",name:"Honduras".t()},{code:"HK",name:"Hong Kong".t()},{code:"HU",name:"Hungary".t()},{code:"IS",name:"Iceland".t()},{code:"IN",name:"India".t()},{code:"ID",name:"Indonesia".t()},{code:"IR",name:"Iran, Islamic Republic of".t()},{code:"IQ",name:"Iraq".t()},{code:"IE",name:"Ireland".t()},{code:"IM",name:"Isle of Man".t()},{code:"IL",name:"Israel".t()},{code:"IT",name:"Italy".t()},{code:"JM",name:"Jamaica".t()},{code:"JP",name:"Japan".t()},{code:"JE",name:"Jersey".t()},{code:"JO",name:"Jordan".t()},{code:"KZ",name:"Kazakhstan".t()},{code:"KE",name:"Kenya".t()},{code:"KI",name:"Kiribati".t()},{code:"KP",name:"Korea, Democratic People's Republic of".t()},{code:"KR",name:"Korea, Republic of".t()},{code:"KW",name:"Kuwait".t()},{code:"KG",name:"Kyrgyzstan".t()},{code:"LA",name:"Lao People's Democratic Republic".t()},{code:"LV",name:"Latvia".t()},{code:"LB",name:"Lebanon".t()},{code:"LS",name:"Lesotho".t()},{code:"LR",name:"Liberia".t()},{code:"LY",name:"Libya".t()},{code:"LI",name:"Liechtenstein".t()},{code:"LT",name:"Lithuania".t()},{code:"LU",name:"Luxembourg".t()},{code:"MO",name:"Macao".t()},{code:"MK",name:"Macedonia, the Former Yugoslav Republic of".t()},{code:"MG",name:"Madagascar".t()},{code:"MW",name:"Malawi".t()},{code:"MY",name:"Malaysia".t()},{code:"MV",name:"Maldives".t()},{code:"ML",name:"Mali".t()},{code:"MT",name:"Malta".t()},{code:"MH",name:"Marshall Islands".t()},{code:"MQ",name:"Martinique".t()},{code:"MR",name:"Mauritania".t()},{code:"MU",name:"Mauritius".t()},{code:"YT",name:"Mayotte".t()},{code:"MX",name:"Mexico".t()},{code:"FM",name:"Micronesia, Federated States of".t()},{code:"MD",name:"Moldova, Republic of".t()},{code:"MC",name:"Monaco".t()},{code:"MN",name:"Mongolia".t()},{code:"ME",name:"Montenegro".t()},{code:"MS",name:"Montserrat".t()},{code:"MA",name:"Morocco".t()},{code:"MZ",name:"Mozambique".t()},{code:"MM",name:"Myanmar".t()},{code:"NA",name:"Namibia".t()},{code:"NR",name:"Nauru".t()},{code:"NP",name:"Nepal".t()},{code:"NL",name:"Netherlands".t()},{code:"NC",name:"New Caledonia".t()},{code:"NZ",name:"New Zealand".t()},{code:"NI",name:"Nicaragua".t()},{code:"NE",name:"Niger".t()},{code:"NG",name:"Nigeria".t()},{code:"NU",name:"Niue".t()},{code:"NF",name:"Norfolk Island".t()},{code:"MP",name:"Northern Mariana Islands".t()},{code:"NO",name:"Norway".t()},{code:"OM",name:"Oman".t()},{code:"PK",name:"Pakistan".t()},{code:"PW",name:"Palau".t()},{code:"PS",name:"Palestine, State of".t()},{code:"PA",name:"Panama".t()},{code:"PG",name:"Papua New Guinea".t()},{code:"PY",name:"Paraguay".t()},{code:"PE",name:"Peru".t()},{code:"PH",name:"Philippines".t()},{code:"PN",name:"Pitcairn".t()},{code:"PL",name:"Poland".t()},{code:"PT",name:"Portugal".t()},{code:"PR",name:"Puerto Rico".t()},{code:"QA",name:"Qatar".t()},{code:"RE",name:"Reunion".t()},{code:"RO",name:"Romania".t()},{code:"RU",name:"Russian Federation".t()},{code:"RW",name:"Rwanda".t()},{code:"BL",name:"Saint Barthelemy".t()},{code:"SH",name:"Saint Helena, Ascension and Tristan da Cunha".t()},{code:"KN",name:"Saint Kitts and Nevis".t()},{code:"LC",name:"Saint Lucia".t()},{code:"MF",name:"Saint Martin (French part)".t()},{code:"PM",name:"Saint Pierre and Miquelon".t()},{code:"VC",name:"Saint Vincent and the Grenadines".t()},{code:"WS",name:"Samoa".t()},{code:"SM",name:"San Marino".t()},{code:"ST",name:"Sao Tome and Principe".t()},{code:"SA",name:"Saudi Arabia".t()},{code:"SN",name:"Senegal".t()},{code:"RS",name:"Serbia".t()},{code:"SC",name:"Seychelles".t()},{code:"SL",name:"Sierra Leone".t()},{code:"SG",name:"Singapore".t()},{code:"SX",name:"Sint Maarten (Dutch part)".t()},{code:"SK",name:"Slovakia".t()},{code:"SI",name:"Slovenia".t()},{code:"SB",name:"Solomon Islands".t()},{code:"SO",name:"Somalia".t()},{code:"ZA",name:"South Africa".t()},{code:"GS",name:"South Georgia and the South Sandwich Islands".t()},{code:"SS",name:"South Sudan".t()},{code:"ES",name:"Spain".t()},{code:"LK",name:"Sri Lanka".t()},{code:"SD",name:"Sudan".t()},{code:"SR",name:"Suriname".t()},{code:"SJ",name:"Svalbard and Jan Mayen".t()},{code:"SZ",name:"Swaziland".t()},{code:"SE",name:"Sweden".t()},{code:"CH",name:"Switzerland".t()},{code:"SY",name:"Syrian Arab Republic".t()},{code:"TW",name:"Taiwan, Province of China".t()},{code:"TJ",name:"Tajikistan".t()},{code:"TZ",name:"Tanzania, United Republic of".t()},{code:"TH",name:"Thailand".t()},{code:"TL",name:"Timor-Leste".t()},{code:"TG",name:"Togo".t()},{code:"TK",name:"Tokelau".t()},{code:"TO",name:"Tonga".t()},{code:"TT",name:"Trinidad and Tobago".t()},{code:"TN",name:"Tunisia".t()},{code:"TR",name:"Turkey".t()},{code:"TM",name:"Turkmenistan".t()},{code:"TC",name:"Turks and Caicos Islands".t()},{code:"TV",name:"Tuvalu".t()},{code:"UG",name:"Uganda".t()},{code:"UA",name:"Ukraine".t()},{code:"AE",name:"United Arab Emirates".t()},{code:"GB",name:"United Kingdom".t()},{code:"US",name:"United States".t()},{code:"UM",name:"United States Minor Outlying Islands".t()},{code:"UY",name:"Uruguay".t()},{code:"UZ",name:"Uzbekistan".t()},{code:"VU",name:"Vanuatu".t()},{code:"VE",name:"Venezuela, Bolivarian Republic of".t()},{code:"VN",name:"Viet Nam".t()},{code:"VG",name:"Virgin Islands, British".t()},{code:"VI",name:"Virgin Islands, U.S.".t()},{code:"WF",name:"Wallis and Futuna".t()},{code:"EH",name:"Western Sahara".t()},{code:"YE",name:"Yemen".t()},{code:"ZM",name:"Zambia".t()},{code:"ZW",name:"Zimbabwe".t()}]}),Ext.define("Ung.store.Categories",{extend:"Ext.data.Store",storeId:"categories",model:"Ung.model.Category"}),Ext.define("Ung.store.UnavailableApps",{extend:"Ext.data.Store",storeId:"unavailableApps",alias:"store.unavailableApps",proxy:{type:"memory",reader:{type:"json"}}}),Ext.define("Ung.model.Policy",{extend:"Ext.data.Model",fields:[{name:"policyId",type:"int"},{name:"displayName",type:"string",convert:function(e,t){return"Policy "+t.get("policyId")}}],hasMany:{model:"Ung.model.NodeProperty",name:"nodeProperties"},proxy:{type:"memory",reader:{type:"json"}}}),Ext.define("Ung.store.Policies",{extend:"Ext.data.Store",alias:"store.policies",storeId:"policies",model:"Ung.model.Policy"}),Ext.define("Ung.model.Stat",{extend:"Ext.data.Model",proxy:{type:"memory",reader:{type:"json"}},fields:["numCpus","cpuModel","MemFree","MemTotal","SwapFree","SwapTotal","freeDiskSpace","totalDiskSpace","uptime",{name:"hostname",calculate:function(){return rpc.hostname}},{name:"version",calculate:function(){return rpc.fullVersion}},{name:"appliance",calculate:function(){return void 0===rpc.applianceModel||null===rpc.applianceModel||""===rpc.applianceModel?"custom".t():rpc.applianceModel}},{name:"totalMemory",calculate:function(e){return Util.formatBytes(e.MemTotal,2)}},{name:"freeMemory",calculate:function(e){return Util.formatBytes(e.MemFree,2)}},{name:"freeMemoryPercent",calculate:function(e){return(e.MemFree/e.MemTotal*100).toFixed(1)}},{name:"usedMemory",calculate:function(e){return Util.formatBytes(e.MemTotal-e.MemFree,2)}},{name:"usedMemoryPercent",calculate:function(e){return(100*(1-e.MemFree/e.MemTotal)).toFixed(1)}},{name:"totalSwap",calculate:function(e){return Util.formatBytes(e.SwapTotal,2)}},{name:"freeSwap",calculate:function(e){return Util.formatBytes(e.SwapFree,2)}},{name:"freeSwapPercent",calculate:function(e){return(e.SwapFree/e.SwapTotal*100).toFixed(1)}},{name:"usedSwap",calculate:function(e){return Util.formatBytes(e.SwapTotal-e.SwapFree,2)}},{name:"usedSwapPercent",calculate:function(e){return(100*(1-e.SwapFree/e.SwapTotal)).toFixed(1)}},{name:"totalDisk",calculate:function(e){return Util.formatBytes(e.totalDiskSpace,2)}},{name:"freeDisk",calculate:function(e){return Util.formatBytes(e.freeDiskSpace,2)}},{name:"freeDiskPercent",calculate:function(e){return(e.freeDiskSpace/e.totalDiskSpace*100).toFixed(1)}},{name:"usedDisk",calculate:function(e){return Util.formatBytes(e.totalDiskSpace-e.freeDiskSpace,2)}},{name:"usedDiskPercent",calculate:function(e){return(100*(1-e.freeDiskSpace/e.totalDiskSpace)).toFixed(1)}},{name:"uptimeFormatted",calculate:function(e){var t=Math.floor(e.uptime%31536e3/86400),i=Math.floor(e.uptime%31536e3%86400/3600),n=Math.floor(e.uptime%31536e3%86400%3600/60),a="";return t>0&&(a+=t+"d "),i>0&&(a+=i+"h "),n>0&&(a+=n+"m"),a}}]}),Ext.define("Ung.store.Stats",{extend:"Ext.data.Store",alias:"store.stats",storeId:"stats",model:"Ung.model.Stat"}),Ext.define("Ung.model.Report",{extend:"Ext.data.Model",fields:["category","colors","conditions","defaultColumns","description","displayOrder","enabled","javaClass","orderByColumn","orderDesc","pieGroupColumn","pieNumSlices","pieStyle","pieSumColumn","readOnly","seriesRenderer","table","textColumns","textString","timeDataColumns","timeDataDynamicAggregationFunction","timeDataDynamicAllowNull","timeDataDynamicColumn","timeDataDynamicLimit","timeDataDynamicValue","timeDataInterval","timeStyle","title","type","uniqueId","units",{name:"icon",calculate:function(e){var t;switch(e.type){case"TEXT":t="fa-align-left";break;case"EVENT_LIST":t="fa-list-ul";break;case"PIE_GRAPH":t="fa-pie-chart","COLUMN"===e.pieStyle||"COLUMN_3D"===e.pieStyle?t="fa-bar-chart":"DONUT"!==e.pieStyle&&"DONUT_3D"!==e.pieStyle||(t="fa-pie-chart");break;case"TIME_GRAPH":case"TIME_GRAPH_DYNAMIC":t="fa-line-chart",e.timeStyle.indexOf("BAR")>=0?t="fa-bar-chart":e.timeStyle.indexOf("AREA")>=0&&(t="fa-area-chart");break;default:t="fa-align-left"}return t}}],proxy:{type:"memory",reader:{type:"json"}}}),Ext.define("Ung.store.Reports",{extend:"Ext.data.Store",storeId:"reports",model:"Ung.model.Report",sorters:[{property:"displayOrder",direction:"ASC"}]}),Ext.define("Ung.model.Widget",{extend:"Ext.data.Model",fields:[{name:"displayColumns",type:"auto",default:null},{name:"enabled",type:"auto",default:!0},{name:"entryId",type:"auto",default:null},{name:"javaClass",type:"string",defaultValue:"com.untangle.uvm.DashboardWidgetSettings"},{name:"refreshIntervalSec",type:"auto",default:null},{name:"timeframe",type:"auto",default:null},{name:"type",type:"string"}],proxy:{type:"memory",reader:{type:"json",rootProperty:"list"}}}),Ext.define("Ung.store.Widgets",{extend:"Ext.data.Store",alias:"store.widgets",storeId:"widgets",model:"Ung.model.Widget"}),Ext.define("Ung.model.Session",{extend:"Ext.data.Model",fields:[{name:"protocol",type:"string"},{name:"clientKBps",type:"number",convert:function(e){return e?Math.round(1e3*e)/1e3:null}},{name:"serverKBps",convert:function(e){return e?Math.round(1e3*e)/1e3:null}},{name:"totalKBps",convert:function(e){return e?Math.round(1e3*e)/1e3:null}},{name:"clientIntf",convert:function(e){return!e||e<0?"":e}},{name:"serverIntf",convert:function(e){return!e||e<0?"":e}}],proxy:{autoLoad:!0,type:"memory",reader:{type:"json"}}}),Ext.define("Ung.store.Sessions",{extend:"Ext.data.Store",storeId:"sessions",model:"Ung.model.Session"}),Ext.define("Ung.controller.Global",{extend:"Ext.app.Controller",namespace:"Ung",requires:["Ung.util.Rpc","Ung.util.Util","Ung.util.Metrics","Ung.view.main.Main","Ung.overrides.form.field.VTypes","Ung.view.shd.Sessions","Ung.view.shd.Hosts","Ung.view.shd.Devices","Ung.config.network.Network"],stores:["Policies","Metrics","Stats","Reports","Widgets","Sessions","Hosts","Conditions","Countries","Categories","UnavailableApps","Rule"],config:{control:{"#main":{beforerender:"onBeforeRender"},"#apps":{activate:"onActivate"}},refs:{mainView:"#main",dashboardView:"#dashboard",appsView:"#apps",reportsView:"#reports"},routes:{"":"onDashboard",expert:"setExpertMode",noexpert:"setNoExpertMode","apps/:policyId":"onApps","apps/:policyId/:node":"onApps",
config:"onConfig","config/:configName":"onConfig","config/:configName/:configView":"onConfig",reports:"onReports","reports/:category":"onReports","reports/:category/:entry":"onReports",sessions:"onSessions",hosts:"onHosts",devices:"onDevices"},reportsEnabled:!0},onBeforeRender:function(){},onActivate:function(){console.log("activate")},setExpertMode:function(){rpc.isExpertMode=!0,this.redirectTo(window.location.hash.replace("|expert",""))},setNoExpertMode:function(){rpc.isExpertMode=!1,this.redirectTo(window.location.hash.replace("|noexpert",""))},onDashboard:function(){this.getMainView().setActiveItem("dashboard"),this.getMainView().getViewModel().set("selectedNavItem","dashboard")},onApps:function(e,t){console.log(t),this.getMainView().getViewModel().set("selectedNavItem","apps"),this.getMainView().setActiveItem("apps"),t?"install"===t&&(console.log(this.getAppsView()),this.getAppsView().setActiveItem("installableApps")):this.getAppsView().setActiveItem("installedApps")},onConfig:function(e,t){var i=this;e?(i.getMainView().setLoading(!0),Ext.Loader.loadScript({url:"root/script/config/"+e+".js",onLoad:function(){i.getMainView().setLoading(!1),i.getMainView().add({xtype:"config."+e,region:"center",itemId:"configCard"}),i.getMainView().setActiveItem("configCard")}})):(this.getMainView().getViewModel().set("selectedNavItem","config"),this.getMainView().setActiveItem("config"))},onReports:function(e){e?this.getReportsView().getViewModel().set("category",e.replace(/-/g," ")):this.getReportsView().getViewModel().set("category",null),this.getMainView().getViewModel().set("selectedNavItem","reports"),this.getMainView().setActiveItem("reports")},onSessions:function(){this.getMainView().add({xtype:"ung.sessions",itemId:"sessions"}),this.getMainView().getViewModel().set("selectedNavItem","sessions"),this.getMainView().setActiveItem("sessions")},onHosts:function(){this.getMainView().add({xtype:"ung.hosts",itemId:"hosts"}),this.getMainView().getViewModel().set("selectedNavItem","hosts"),this.getMainView().setActiveItem("hosts")},onDevices:function(){this.getMainView().add({xtype:"ung.devices",itemId:"devices"}),this.getMainView().getViewModel().set("selectedNavItem","devices"),this.getMainView().setActiveItem("devices")}}),Ext.define("Ung.Application",{extend:"Ext.app.Application",namespace:"Ung",autoCreateViewport:!1,name:"Ung",rpc:null,controllers:["Global"],defaultToken:"",mainView:"Ung.view.main.Main",init:function(){console.timeEnd("resources"),rpc.translations.decimal_sep||(rpc.translations.decimal_sep="."),rpc.translations.thousand_sep||(rpc.translations.thousand_sep=","),rpc.translations.date_fmt||(rpc.translations.date_fmt="Y-m-d"),rpc.translations.timestamp_fmt||(rpc.translations.timestamp_fmt="Y-m-d h:i:s a")},launch:function(){var e=this;Ext.getStore("policies").loadData(e.rpc.appsViews),Metrics.start(),Ext.get("app-loader").destroy(),rpc.reportsManager=rpc.nodeManager.node("untangle-node-reports").getReportsManager(),Ext.Deferred.parallel([Rpc.asyncPromise("rpc.dashboardManager.getSettings"),Rpc.asyncPromise("rpc.reportsManager.getReportEntries"),Rpc.asyncPromise("rpc.reportsManager.getUnavailableApplicationsMap")]).then(function(e){Ung.dashboardSettings=e[0],Ext.getStore("widgets").loadData(e[0].widgets.list),e[1]&&Ext.getStore("reports").loadData(e[1].list),e[2]&&Ext.getStore("unavailableApps").loadRawData(e[2].map),Ext.fireEvent("init")},function(e){console.log(e)})},loadMainView:function(){Util.Metrics.start();try{Ung.app.setMainView("Ung.view.main.Main")}catch(e){return console.error(e),void Util.exceptionToast(e)}}});